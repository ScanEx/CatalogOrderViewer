{"version":3,"file":"permalink.min.js","sources":["../node_modules/scanex-event-target/index.js","../node_modules/scanex-jsonp-request/index.js","../node_modules/scanex-auth/src/AuthManager/AuthManager.js","../node_modules/scanex-object-extensions/index.js","../node_modules/scanex-dropdown-widget/src/DropdownWidget.js","../node_modules/scanex-dropdown-widget/src/DropdownMenuWidget.js","../node_modules/scanex-translations/index.js","../node_modules/scanex-auth/src/AuthWidget/AuthWidget.js","../node_modules/scanex-auth/src/AuthManager/Server.js","../node_modules/scanex-auth/src/AuthManager/ResourceServer.js","../node_modules/scanex-auth/src/AuthManager/api.js","../node_modules/scanex-async/index.js","../src/js/config/constants/Constants.js","../src/js/config/satellites/Satellites.js","../src/js/utils/CommonUtils.js","../src/js/permalink.js"],"sourcesContent":["class EventTarget {\r\n    constructor() {\r\n        this.listeners = {};\r\n    }\r\n    addEventListener(type, callback) {\r\n        if(!(type in this.listeners)) {\r\n            this.listeners[type] = [];\r\n        }\r\n        this.listeners[type].push(callback);\r\n    }\r\n    on(type, callback) {\r\n        this.addEventListener(type, callback);\r\n        return this;\r\n    }\r\n    removeEventListener (type, callback) {\r\n        if(!(type in this.listeners)) {\r\n            return;\r\n        }\r\n        let stack = this.listeners[type];\r\n        for(let i = 0, l = stack.length; i < l; i++) {\r\n            if(stack[i] === callback){\r\n                stack.splice(i, 1);\r\n                return this.removeEventListener(type, callback);\r\n            }\r\n        }\r\n    }\r\n    off(type, callback) {\r\n        this.removeEventListener(type, callback);\r\n        return this;\r\n    }\r\n    dispatchEvent(event) {\r\n        if(!(event.type in this.listeners)) {\r\n            return;\r\n        }\r\n        let stack = this.listeners[event.type];\r\n\t    Object.defineProperty(event, 'target', {\r\n            enumerable: false,\r\n            configurable: false,\r\n            writable: false,\r\n            value: this\r\n        });\r\n        for(let i = 0, l = stack.length; i < l; i++) {\r\n            stack[i].call(this, event);\r\n        }\r\n    }\r\n    \r\n}\r\n\r\nexport default EventTarget;","let uniqueGlobalName = (() => {\r\n    let freeid = 0;\r\n    return thing => {\r\n        let id = `gmx_unique_${freeid++}`;\r\n        window[id] = thing;\r\n        return id;\r\n    };\r\n})();\r\n\r\n\r\n/** Посылает кросс-доменный GET запрос к серверу с использованием транспорта JSONP.\r\n *\r\n * @memberOf nsGmx.Utils\r\n * @param {String} url URL сервера.\r\n * @param {Function} callback Ф-ция, которая будет вызвана при получении от сервера результата.\r\n * @param {String} [callbackParamName=CallbackName] Имя параметра для задания имени ф-ции ответа.\r\n * @param {Function} [errorCallback] Ф-ция, которая будет вызвана в случае ошибки запроса к серверу\r\n */\r\nfunction sendCrossDomainJSONRequest (url, callback, callbackParamName, errorCallback) {\r\n\tcallbackParamName = callbackParamName || 'CallbackName';\r\n\r\n    let script = document.createElement(\"script\");\r\n\tscript.setAttribute(\"charset\", \"UTF-8\");\r\n\tlet callbackName = uniqueGlobalName(obj => {\r\n\t\tcallback && callback(obj);\r\n\t\twindow[callbackName] = false;\r\n\t\tdocument.getElementsByTagName(\"head\").item(0).removeChild(script);\r\n\t});\r\n\r\n    let sepSym = url.indexOf('?') == -1 ? '?' : '&';\r\n\r\n    if (errorCallback) {\r\n        script.onerror = errorCallback;\r\n    }\r\n\r\n\tscript.setAttribute(\"src\", `${url}${sepSym}${callbackParamName}=${callbackName}&${Math.random()}`);\r\n\tdocument.getElementsByTagName(\"head\").item(0).appendChild(script);\r\n}\r\n\r\nexport { sendCrossDomainJSONRequest };","import EventTarget from 'scanex-event-target';\r\nimport { sendCrossDomainJSONRequest } from 'scanex-jsonp-request';\r\n\r\nclass AuthManager extends EventTarget {\r\n    constructor({\r\n        authorizationEndpoint, \r\n        userInfoEndpoint, \r\n        redirectEndpointHtml, \r\n        redirectEndpointAshx,         \r\n        credentialLoginEndpoint,\r\n        clientId = 1}){\r\n        super();\r\n        // поддерживаем как минимум два события для\r\n        // серверов ресурсов: login и logout\r\n        this._authorizationEndpoint = authorizationEndpoint;\r\n        this._userInfoEndpoint = userInfoEndpoint;\r\n        this._redirectEndpointHtml = redirectEndpointHtml;\r\n        this._redirectEndpointAshx = redirectEndpointAshx;\r\n        this._redirectEndpointAshx2 = `${redirectEndpointAshx}/?return_url=${location.href}`;\r\n        this._credentialLoginEndpoint = credentialLoginEndpoint;\r\n        this._resourceServers = [];\r\n        this._clientId = clientId;\r\n    }\r\n    $getAntiCsrfToken() {\r\n        const cookieName = \"sync\";\r\n        const re = new RegExp(`.*${cookieName}=([^;]+).*`, 'i');\r\n        return document.cookie.replace(re, '$1');        \r\n    }\r\n    /** Добавляет сервер ресурсов\r\n     * Должна вызываться только из класса ResourceServer.\r\n     * @param {ResourceServer} resourceServer\r\n     */\r\n    $addResourceServer (resourceServer) {\r\n        this._resourceServers.push(resourceServer);\r\n    }    \r\n    _chain (tasks, state) {        \r\n        return tasks.reduce(\r\n            (prev, next) => prev.then(next),\r\n            new Promise ((resolve, reject) => resolve (state))\r\n        );\r\n    }\r\n    _authorizeResourceServers () {\r\n        let tasks = this._resourceServers.map(rs => {\r\n            return state => {\r\n                return new Promise(resolve => {\r\n                    rs.sendGetRequest('oAuth2/LoginDialog.ashx')\r\n                    .then(response => {\r\n                        state = state.concat(response);\r\n                        resolve(state);\r\n                    })\r\n                    .catch(e => state.push(e));\r\n                });\r\n            };\r\n        });\r\n        return this._chain(tasks, []);\r\n    }\r\n    _processAuthorization (search){\r\n        function parseQueryString (search) {\r\n            let a = search.slice(1).split('&');\r\n            let o = {};\r\n            for (let i = 0; i < a.length; i++) {\r\n                let s = a[i].split('=');\r\n                o[s[0]] = s[1];\r\n            }\r\n            return o;\r\n        }\r\n        return new Promise((resolve, reject) => {            \r\n            // превращаем строку с параметрами в хеш\r\n            let params = parseQueryString(search);\r\n\r\n            if (params.error) {\r\n                reject({\r\n                    Status: 'auth',\r\n                    Result: null,\r\n                    Error: {\r\n                        message: params.error\r\n                    }\r\n                });\r\n            } else {\r\n                sendCrossDomainJSONRequest(`${this._redirectEndpointAshx}${search}`,\r\n                resp => {\r\n                    if (resp.Status === 'ok') {\r\n                        resolve({\r\n                            Status: 'ok',\r\n                            Result: resp.Result\r\n                        });\r\n                    } else {\r\n                        reject({\r\n                            Status: resp.Status,\r\n                            Result: null\r\n                        });\r\n                    }\r\n                }, \r\n                'CallbackName', \r\n                () => {\r\n                    reject({\r\n                        Status: 'network',\r\n                        Result: null,\r\n                        Error: {\r\n                            message: arguments[2]\r\n                        }\r\n                    });\r\n                });                \r\n            }\r\n        });\r\n    }\r\n    /** Получение информации о пользователе от AuthServer\r\n     * @return {Function} promise(userInfo)\r\n     */\r\n    getUserInfo(){\r\n        if (this._getUserInfoDeferred) {\r\n            return this._getUserInfoDeferred;\r\n        }        \r\n        return this._getUserInfoDeferred = new Promise((resolve, reject) => {\r\n\r\n            function authorizationGrant(search) {\r\n                // удаляем айфрейм и глобальную переменную\r\n                setTimeout(function() {\r\n                    delete window.authorizationGrant;\r\n                    document.body.removeChild (document.body.querySelector('.authorizationIframe'));                    \r\n                }, 0);\r\n\r\n                this._processAuthorization(search).then(resp => resolve(resp), (err) => reject(err));\r\n            }\r\n\r\n            // посылаем запросы на все сервера ресурсов\r\n            // когда они все ответят ..\r\n            this._authorizeResourceServers()\r\n            .then(servers => {\r\n                // .. формируем параметры state и scope\r\n                let scope = '';\r\n                let state = '';\r\n                for (let i = 0; i < servers.length; i++) {\r\n                    let response = servers[i];\r\n                    scope += response.Service.ServerId + ',';\r\n                    state += response.Result.State + ',';\r\n                }\r\n                scope = scope.slice(0, -1);\r\n                state = state.slice(0, -1);\r\n\r\n                // .. и посылаем запрос на сервер авторизации\r\n                window.authorizationGrant = authorizationGrant.bind(this);\r\n                document.body.insertAdjacentHTML('afterbegin', \r\n                `<iframe\r\n                    class=\"authorizationIframe\"\r\n                    style=\"display: block !important; position: absolute; left: -99999px;\"\r\n                    src=\"${this._userInfoEndpoint}/?client_id=1&redirect_uri=${this._redirectEndpointHtml}&scope=${scope}&state=${state}\">\r\n                </iframe>`);\r\n\r\n            })\r\n            .catch(() => {\r\n                reject({\r\n                    Status: 'error'\r\n                });\r\n            });\r\n\r\n        });               \r\n    }\r\n    /** Принудительное перелогинивание пользователя.\r\n     * Пользователь должен увидеть поля для ввода\r\n     * логина/пароля (возможно, на сервере авторизации).\r\n     * При успешной авторизации библиотека должна\r\n     * произвести авторизацию пользователя на всех\r\n     * подключенных серверах ресурсов\r\n     * и только после этого resolve promise\r\n     * @return {Function} promise(userInfo)\r\n     */\r\n    login (arg) {\r\n        let foreignServer;\r\n        let iframeContainer;\r\n        if (typeof arg === 'string') {\r\n            // обратная совместимость\r\n            foreignServer = arg;\r\n        } else if (typeof arg === 'object') {\r\n            foreignServer = arg.foreignServer;\r\n            iframeContainer = arg.iframeContainer;\r\n        }\r\n        \r\n        this._authorizeResourceServers()\r\n        .then(servers => {\r\n            // .. формируем параметры state и scope\r\n            let scope = '';\r\n            let state = '';\r\n            for (let i = 0; i < servers.length; i++) {\r\n                let response = servers[i];\r\n                scope += response.Service.ServerId + ',';\r\n                state += response.Result.State + ',';\r\n            }\r\n            scope = scope.slice(0, -1);\r\n            state = state.slice(0, -1);\r\n\r\n            let authUrl = `${this._authorizationEndpoint}/?client_id=1&redirect_uri=${this._redirectEndpointAshx2}&scope=${scope}&state=${state}`;\r\n\r\n            if (foreignServer) {\r\n                authUrl += `&authserver=${foreignServer}`;\r\n            }\r\n\r\n            if (!iframeContainer) {\r\n                window.open(authUrl, '_self');\r\n            } else {\r\n                window.authorizationGrant = authorizationGrant;\r\n                document.body.removeChild(document.body.querySelector('.authorizationIframe'));\r\n                document.body.insertAdjacentHTML('afterbegin', \r\n                `<iframe\r\n                    class=\"authorizationIframe\"\r\n                    src=\"${self._authorizationEndpoint}/?client_id=1\r\n                        &redirect_uri=${self._redirectEndpointHtml}\r\n                        &redirect_uri_alt=${self._redirectEndpointAshx2}\r\n                        &scope=${scope}\r\n                        &state=${state}\">\r\n                </iframe>`);\r\n\r\n                function authorizationGrant() {\r\n                    window.location.reload();                    \r\n                    let event = document.createEvent('Event');\r\n                    event.initEvent('login', false, false);\r\n                    this.dispatchEvent(event);\r\n                }\r\n            }\r\n        });\r\n    }\r\n    /** Залогиниться, используя логин и пароль\r\n     * @param  {String} login\r\n     * @param  {String} password\r\n     * @return {Promise}\r\n     */\r\n    loginWithCredentials (login, password) {\r\n        // отправляем ajax-запрос на Handler/Login с логином и паролем\r\n        // После этого пользователь считается залогиненным на my.\r\n        // Затем вызываем getUserInfo()\r\n\r\n        return new Promise ((resolve, reject) => {            \r\n            sendCrossDomainJSONRequest(\r\n                `${this._credentialLoginEndpoint}?login=${encodeURIComponent(login)}&password=${encodeURIComponent(password)}`,\r\n                response => {\r\n                    if (response.Status.toLowerCase() === 'ok') {\r\n                        this.getUserInfo()\r\n                        .then(() => {\r\n                            resolve({\r\n                                Status: 'ok',\r\n                                Result: arguments[0].Result\r\n                            });\r\n                        })\r\n                        .catch(() => {\r\n                            reject({\r\n                                Status: 'error',\r\n                                Result: {\r\n                                    Message: 'authorization error'\r\n                                }\r\n                            });\r\n                        });\r\n                    } else if (response.Status.toLowerCase() === 'auth') {\r\n                        reject({\r\n                            Status: 'auth',\r\n                            Result: {\r\n                                Message: response.Result.Message\r\n                            }\r\n                        });\r\n                    } else {\r\n                        reject({\r\n                            Status: 'error',\r\n                            Result: {\r\n                                Message: 'unknown error'\r\n                            }\r\n                        });\r\n                    }\r\n                },\r\n                'CallbackName',\r\n                () => {\r\n                    reject({\r\n                        Status: 'network',\r\n                        Result: {\r\n                            Message: 'network error'\r\n                        }\r\n                    });\r\n                }\r\n            );\r\n        });        \r\n    }\r\n    /** Принудительное разлогинивание пользователя.\r\n     * В том числе и на серверах ресурсов\r\n     * @return {Function} promise(status)\r\n     */\r\n    logout () {\r\n        return new Promise ((resolve, reject) => {\r\n            let promises = [];\r\n            for (let i = 0; i < this._resourceServers.length; i++) {\r\n                let resourceServer = this._resourceServers[i];\r\n                let promise = resourceServer.sendGetRequest('oAuth2/Logout.ashx');\r\n                promises.push(promise);\r\n            }\r\n            this._chain(promises, {})\r\n            .then(() => {\r\n                if (this._clientId === 1) {\r\n                    sendCrossDomainJSONRequest('//my.kosmosnimki.ru/Handler/Logout',\r\n                    (response) => resolve({ Status: 'ok'}), '', () => reject({ Status: 'network'}));\r\n                } else {\r\n                    resolve({\r\n                        Status: 'ok'\r\n                    });                    \r\n                    let event = document.createEvent('Event');\r\n                    event.initEvent('logout', false, false);\r\n                    this.dispatchEvent(event);\r\n                }\r\n            })\r\n            .catch(() => {\r\n                reject({\r\n                    Status: 'error'\r\n                });\r\n            });            \r\n        });           \r\n    }\r\n}\r\n\r\nexport default AuthManager;\r\n","const copy = source => {\r\n    switch(typeof source) {\r\n        case 'number':\r\n        case 'string':\r\n        case 'function':\r\n        default:\r\n            return source;\r\n        case 'object':\r\n            if (source === null) {\r\n                return null;\r\n            }\r\n            else if (Array.isArray(source)) {\r\n                return source.map (item => copy (item));\r\n            }\r\n            else if (source instanceof Date) {\r\n                return source;\r\n            }\r\n            else {                \r\n                return Object.keys(source).reduce((a, k) => {                    \r\n                    a[k] = copy(source[k]);\r\n                    return a;\r\n                }, {});\r\n            }\r\n    }\r\n};\r\n\r\nconst extend = (target, source) => {\r\n    if (target === source) {\r\n\t    return target;\r\n    }\r\n    else {\r\n        return Object.keys(source).reduce((a, k) => {\r\n            let value = source[k];\r\n            if(typeof a[k] === 'object' && (k in a)){\r\n                a[k] = extend (a[k], value);\r\n            }\r\n            else {\r\n               a[k] = copy(value);\r\n            }\r\n            return a;\r\n        }, copy (target));\r\n    }    \r\n};\r\n\r\n\r\nexport {copy, extend};","import './DropdownWidget.css';\r\nimport EventTarget from 'scanex-event-target';\r\nimport { extend } from 'scanex-object-extensions';\r\n\r\n// <String>options.title\r\n// <String>options.className\r\n// <String>options.trigger (hover|click|manual)\r\n// <String>options.direction (down|up)\r\n// <Boolean>options.adjustWidth\r\n// <Boolean>options.showTopItem\r\nclass DropdownWidget extends EventTarget {\r\n    constructor (options){\r\n        super();\r\n        this.options = extend({\r\n            title: '',\r\n            trigger: 'hover',\r\n            direction: 'down',\r\n            adjustWidth: true,\r\n            showTopItem: true,\r\n            titleClassName: ''\r\n        }, options);\r\n\r\n        this.$el = this.options.el;\r\n        this.$el.classList.add ('dropdownWidget');\r\n        this.$el.classList.add ('dropdownWidget-item');        \r\n\r\n        this.$titleContainer = document.createElement('div');\r\n        this.$titleContainer.classList.add('dropdownWidget-dropdownTitle');\r\n        if (this.options.titleClassName) {\r\n            this.$titleContainer.classList.add(this.options.titleClassName);\r\n        }        \r\n        this.$titleContainer.innerHTML = this.options.title;\r\n        this.$el.appendChild(this.$titleContainer);\r\n        \r\n        this.$dropdownContainer = document.createElement('div');\r\n        this.$dropdownContainer.classList.add('dropdownWidget-dropdown');\r\n        this.$dropdownContainer.style.display = 'none';\r\n        this.$el.appendChild(this.$dropdownContainer);\r\n\r\n        this.$dropdownTitle = document.createElement('div');        \r\n        this.$dropdownTitle.classList.add('dropdownWidget-item');\r\n        this.$dropdownTitle.classList.add('dropdownWidget-dropdownTitle');\r\n        if(options.titleClassName) {\r\n            this.$dropdownTitle.classList.add(options.titleClassName);\r\n        }        \r\n        this.$dropdownTitle.innerHTML = this.options.title;\r\n        this.$dropdownContainer.appendChild(this.$dropdownTitle);            \r\n\r\n        if (!this.options.showTopItem) {\r\n            this.$dropdownTitle.style.display = 'none';\r\n        }\r\n\r\n        if (this.options.trigger === 'hover') {\r\n            this.$dropdownTitle.classList.add('ui-state-disabled');\r\n            this.$titleContainer.addEventListener('mouseover', () => this.expand());\r\n            this.$dropdownContainer.addEventListener('mouseleave', () => this.collapse());\r\n        } else if (this.options.trigger === 'click') {\r\n            this.$titleContainer.addEventListener('click', () => this.expand());\r\n            this.$dropdownTitle.addEventListener('click', () => this.collapse());\r\n        }\r\n\r\n        if (this.options.direction === 'up') {\r\n            this.$el.classList.add('dropdownWidget_direction-up');\r\n        } else {\r\n            this.$el.classList.add('dropdownWidget_direction-down');\r\n        }\r\n\r\n        this._items = {};\r\n    }\r\n    addItem (id, inst, position) {\r\n        this._items[id] = inst;\r\n\r\n        let $container = document.createElement('div');\r\n        \r\n        $container.classList.add('dropdownWidget-item');\r\n        $container.classList.add('dropdownWidget-dropdownItem');\r\n        $container.setAttribute('data-id', id);            \r\n        $container.setAttribute('data-position', position);\r\n        $container.addEventListener('click', je => {            \r\n            let event = document.createEvent('Event');\r\n            event.initEvent('item:click', false, false);\r\n            event.detail = { dataId: je.currentTarget.getAttribute('data-id') };\r\n            this.dispatchEvent(event);\r\n            \r\n            if (this.options.trigger === 'click') {\r\n                this.collapse();\r\n            }            \r\n        });\r\n        $container.appendChild(inst.el);\r\n        this.$dropdownContainer.appendChild($container);\r\n        this._sortItems()\r\n    }\r\n\r\n    setTitle (title) {\r\n        this.$titleContainer.innerHTML = title;\r\n        this.$dropdownTitle.innerHTML = title;\r\n    }\r\n\r\n    toggle () {\r\n        this._expanded ? this.collapse() : this.expand();\r\n        this._expanded = !this._expanded;\r\n    }\r\n\r\n    expand () {\r\n        const r = this.$el.getBoundingClientRect();\r\n        this.$dropdownContainer.style.minWidth = `${r.width}px`;\r\n        this.$dropdownContainer.style.display = 'block';\r\n        let event = document.createEvent('Event');\r\n        event.initEvent('expand', false, false);\r\n        event.detail = {};\r\n        this.dispatchEvent(event);\r\n    }\r\n\r\n    collapse () {\r\n        this.$dropdownContainer.style.display = 'none';\r\n        let event = document.createEvent('Event');\r\n        event.initEvent('collapse', false, false);\r\n        event.detail = {};\r\n        this.dispatchEvent(event);\r\n    }\r\n\r\n    reset () {\r\n        this.collapse();\r\n    }\r\n\r\n    _sortItems () {\r\n        let containerEl = this.$dropdownContainer[0];\r\n        let items = Array.prototype.slice.call(containerEl.children);\r\n\r\n        let titleEl = items.splice(\r\n            items.indexOf(containerEl.querySelector('.dropdownWidget-dropdownTitle')), 1\r\n        );\r\n\r\n        while (items.length) {            \r\n            let positions = items.map(el => parseInt (el.getAttribute('data-position'), 10));\r\n            let maxPositionIndex = positions.indexOf(Math.max.apply(null, positions));\r\n            containerEl.insertBefore(items.splice(maxPositionIndex, 1)[0], containerEl.children[0]);\r\n        }\r\n\r\n        if (this.options.direction === 'up') {\r\n            containerEl.appendChild(titleEl);\r\n        } else {\r\n            containerEl.insertBefore(titleEl, containerEl.children[0]);\r\n        }\r\n    }\r\n}\r\n\r\nexport default DropdownWidget;","import './DropdownMenuWidget.css';\r\n\r\nclass DropdownMenuWidget {\r\n    constructor(options) {\r\n\r\n        this._view = document.createElement('div');\r\n        this._view.classList.add('dropdownMenuWidget');        \r\n        this._view.innerHTML = options.items.map(this._renderItem.bind(this)).join('');\r\n        let dropDown = this._view.querySelector('.dropdownMenuWidget-itemDropdown');\r\n        if(dropDown) {\r\n            dropDown.style.display = 'none';\r\n        }\r\n        let mouseTimeout = options.mouseTimeout || 100;\r\n        let items = this._view.querySelectorAll('.dropdownMenuWidget-item');\r\n        for (let i = 0; i < items.length; ++i){\r\n            let mouseIsOver = false;\r\n            items[i].addEventListener('mouseenter', je => {\r\n                mouseIsOver = true;\r\n                setTimeout(() => {\r\n                    if (mouseIsOver) {\r\n                        let dd = je.target.querySelector('.dropdownMenuWidget-itemDropdown');\r\n                        if(dd) {\r\n                            dd.style.display = 'block';\r\n                        }\r\n                        \r\n                    }\r\n                }, 100);\r\n            });\r\n            items[i].addEventListener('mouseleave', je => {\r\n                mouseIsOver = false;\r\n                let dd = je.target.querySelector('.dropdownMenuWidget-itemDropdown');\r\n                if(dd) {\r\n                    dd.style.display = 'none';\r\n                }                \r\n            });\r\n        }\r\n    }\r\n    _renderDropdown ({className, id, link, newWindow, icon, title}) {\r\n        return `<li class=\"dropdownMenuWidget-dropdownMenuItem${ className ? (' ' + className) : ''}\">\r\n            ${ newWindow ? '<div class=\"ui-icon ui-icon-newwin dropdownMenuWidget-dropdownMenuIcon\"></div>' : ''}\r\n            <a\r\n                ${ id ? 'id=\"' + id + '\"' : ''}\r\n                ${ link ? 'href=\"' + link + '\"' : 'href=\"javascript:void(0)\"'}\r\n                ${ newWindow && link ? 'target=\"_blank\"' : ''}\r\n                class=\"dropdownMenuWidget-dropdownItemAnchor${ newWindow ? ' dropdownMenuWidget-dropdownItemAnchor_newWindow' : ''}\"\r\n            >\r\n                ${ icon ? '<img src=\"' + icon + '\"/>' : ''}\r\n                ${ title ? '<span>' + title + '</span>' : ''}\r\n            </a>\r\n        </li>`;\r\n    }\r\n    _renderItem({className, id, link, newWindow, icon, fonticon, title, dropdown}) {\r\n        return `<div class=\"dropdownMenuWidget-item${className ? ' ' + className : ''}\">\r\n        <a\r\n            ${ id ? 'id=\"' + id + '\"' : ''}\r\n            ${ link ? 'href=\"' + link + '\"' : 'href=\"javascript:void(0)\"'}\r\n            ${ newWindow && link ? 'target=\"_blank\"': ''}\r\n            class=\"dropdownMenuWidget-itemAnchor${ newWindow ? ' dropdownMenuWidget-itemAnchor_newWindow': ''}\"\r\n        >\r\n            ${ icon ? '<img src=\"' + icon + '\" />' : ''}\r\n            ${ fonticon ? '<i class=\"' + fonticon + '\"></i>' : ''}\r\n            ${ title ? '<span>' + title + '</span>' + (dropdown ? '<i class=\"icon-angle-down\"></i>' : '') : ''}\r\n        </a>\r\n        ${dropdown ? \r\n            '<div class=\"dropdownMenuWidget-itemDropdown\">\\\r\n                <ul class=\"dropdownMenuWidget-dropdownMenu\">' + dropdown.map(this._renderDropdown.bind(this)).join('') + '</ul>\\\r\n            </div>'\r\n            : ''}\r\n        </div>`;\r\n    }\r\n    appendTo (placeholder) {\r\n        placeholder.appendChild(this._view);\r\n    }\r\n}\r\n\r\nexport default DropdownMenuWidget;","import { extend } from 'scanex-object-extensions';\r\n\r\nconst DEFAULT_LANGUAGE = 'rus';\r\n\r\nclass Translations {\r\n    constructor(){\r\n        this._hash = {};\r\n    }    \r\n    setLanguage (lang) {\r\n        this._language = lang;\r\n    }\r\n    getLanguage () {\r\n        return window.language || this._language || DEFAULT_LANGUAGE;\r\n    }\r\n    addText (lang, tran) {        \r\n        this._hash[lang]= extend(this._hash[lang] || {}, tran);\r\n        return this;\r\n    }\r\n    getText (key) {\r\n        if(key && typeof key === 'string') {\r\n            let locale = this._hash[this.getLanguage()];\r\n            if (locale) {\r\n                return key\r\n                    .split('.')\r\n                    .reduce((a, k) => a[k], locale);\r\n            }         \r\n        }\r\n        return null;\r\n    }\r\n}\r\n\r\nwindow.Scanex = window.Scanex || {};\r\nwindow.Scanex.Translations = window.Scanex.Translations || {};\r\nwindow.Scanex.translations = window.Scanex.translations || new Translations();\r\n\r\nexport default window.Scanex.translations;","import 'scanex-dropdown-widget/dist/scanex-dropdown-widget.css';\r\nimport { MenuWidget } from 'scanex-dropdown-widget';\r\n\r\nimport EventTarget from 'scanex-event-target';\r\nimport Translations from 'scanex-translations';\r\nimport '../assets/account.css';\r\nimport './AuthWidget.css';\r\n\r\nconst T = Translations;\r\n\r\nT.addText('rus', {\r\n\tauth: {\r\n\t\t'login': 'Войти',\r\n\t\t'logout': 'Выйти',\r\n\t\t'myAccount': 'Личный кабинет',\r\n\t\t'myMap': 'Личная карта',\r\n\t\t'closeDialog': 'Закрыть'\r\n\t}\r\n});\r\n\r\nT.addText('eng', {\r\n\tauth: {\r\n\t\t'login': 'Login',\r\n\t\t'logout': 'Logout',\r\n\t\t'myAccount': 'My account',\r\n\t\t'myMap': 'My map',\r\n\t\t'closeDialog': 'Close'\r\n\t}\r\n});\r\n\r\nclass AuthWidget extends EventTarget {\r\n    constructor(options) {\r\n        super();\r\n        this._view = document.createElement('div');\r\n        this._view.classList.add('authWidget');\r\n\r\n        this._authManager = options.authManager;\r\n        this._userInfo = null;\r\n        \r\n        this._options = options;\r\n        this._options.showAccountLink = true;\r\n        this._options.accountLink = `//my.kosmosnimki.ru/Home/Settings/`;\r\n        this._options.showMapLink = true;\r\n\r\n        this._authManager.getUserInfo()\r\n        .then(response => {\r\n            this._render({\r\n                login: response.Result && response.Result.Login,\r\n                userName: response.Result && (response.Result.FullName || response.Result.Nickname || response.Result.Login),\r\n                nickName: response.Result.Nickname,\r\n            });\r\n            this._userInfo = response.Result;            \r\n            let event = document.createEvent('Event');\r\n            event.initEvent('ready', false, false);\r\n            this.dispatchEvent(event);\r\n        })\r\n        .catch((response) => {\r\n            this._render(response);\r\n        });\r\n        this._authManager.addEventListener('login', () => {            \r\n            let event = document.createEvent('Event');\r\n            event.initEvent('login', false, false);\r\n            this.dispatchEvent(event);\r\n        });\r\n    }\r\n    _render (vm) {\r\n        this._view.innerHTML = vm.nickName ?\r\n            `<div class=\"authWidget_authorized\">\r\n                <div class=\"authWidget-userPanel\">\r\n                    <div class=\"authWidget-userPanel-iconCell\">\r\n                        <div class=\"authWidget-userPanel-userIcon account account-user-logout\"></div>\r\n                    </div>\r\n                    <div class=\"authWidget-userPanel-userMenuCell\"></div>\r\n                </div>\r\n            </div>` : \r\n            `<div class=\"authWidget_unauthorized\">\r\n                <!-- div class=\"authWidget-loginButton\">${T.getText('auth.login')}</div -->\r\n                <div class=\"authWidget-loginButton account account-user-login\"></div>\r\n            </div>`;        \r\n\r\n        if (vm.nickName) {\r\n            var dropdownItems = [];\r\n\r\n            if (this._options.showAccountLink) {\r\n                dropdownItems.push({\r\n                    title: T.getText('auth.myAccount'),\r\n                    link: this._options.accountLink,\r\n                    id: 'AuthWidgetAccountLink',\r\n                    newWindow: true,\r\n                    iconClass: 'account account-personal-area',\r\n                });\r\n            }\r\n\r\n            if (this._options.showMapLink) {\r\n                let defaultMapLink = `//maps.kosmosnimki.ru/api/index.html?${encodeURIComponent('@' + vm.login)}`;\r\n                dropdownItems.push({\r\n                    title: T.getText('auth.myMap'),\r\n                    link: this._options.mapLink || defaultMapLink,\r\n                    id: 'AuthWidgetMapLink',\r\n                    newWindow: true,\r\n                    iconClass: 'account account-personal-map',\r\n                });\r\n            }\r\n\r\n            dropdownItems.push({\r\n                title: T.getText('auth.logout'),\r\n                className: 'authWidget-logoutButton',\r\n                iconClass: 'account account-exit',\r\n            });\r\n\r\n            var dropdownMenuWidget = new MenuWidget({\r\n                items: [{\r\n                    title: vm.nickName,\r\n                    dropdown: dropdownItems\r\n                }]\r\n            });\r\n\r\n            dropdownMenuWidget.appendTo(this._view.querySelector('.authWidget-userPanel-userMenuCell'));\r\n        }\r\n\r\n\r\n        let loginBtn = this._view.querySelector('.authWidget-loginButton');\r\n        if (loginBtn) {\r\n            loginBtn.addEventListener('click', e => {\r\n                var $iframeContainer;\r\n                // if (this._options.loginDialog) {\r\n\r\n                //     $iframeContainer = document.createElement('div');\r\n                //     $iframeContainer.classList.add('authWidget-iframeContainer');\r\n                //     var dialog = $iframeContainer.dialog({\r\n                //         width: 500,\r\n                //         height: 450,\r\n                //         closeText: T.getText('auth.closeDialog'),\r\n                //         close: (je, ui) => {\r\n                //             $(this).dialog('destroy');\r\n                //         }\r\n                //     });\r\n                //     // HACK:\r\n                //     let btn = $iframeContainer.querySelector('button.ui-button');\r\n                //     if (btn) {\r\n                //         btn.classList.add('ui-icon');\r\n                //         btn.style.outline = 'none';\r\n                //     }                                \r\n                // }\r\n\r\n                this._authManager.login({\r\n                    iframeContainer: $iframeContainer && $iframeContainer[0]\r\n                });\r\n            });\r\n        }\r\n        \r\n\r\n        let logoutBtn = this._view.querySelector('.authWidget-logoutButton');\r\n        if(logoutBtn) {\r\n            logoutBtn.addEventListener('click', e => {\r\n                this._authManager.logout()\r\n                .then(response => {\r\n                    this._render(response);\r\n                    this._userInfo = response.Result;                    \r\n                    let event = document.createEvent('Event');\r\n                    event.initEvent('logout', false, false);\r\n                    this.dispatchEvent(event);\r\n                });\r\n            });\r\n        }        \r\n    }\r\n\r\n    /** Получить информацию о пользователе, которую вернул AuthManager\r\n     * @return {Object}\r\n     */\r\n    getUserInfo () {\r\n        return this._userInfo;\r\n    }\r\n\r\n    appendTo (placeholder) {\r\n        placeholder.appendChild(this._view);\r\n    }\r\n}\r\n\r\nexport default AuthWidget;","import { sendCrossDomainJSONRequest } from 'scanex-jsonp-request';\r\n\r\n//TODO: использовать ли библиотеку?\r\nfunction parseUri(str)\r\n{\r\n    var parser = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,\r\n        key = [\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"],\r\n        m = parser.exec(str),\r\n        uri = {},\r\n        i   = 14;\r\n\r\n    while (i--) uri[key[i]] = m[i] || \"\";\r\n    \r\n    // HACK\r\n    uri.hostOnly = uri.host;\r\n    uri.host = uri.authority;\r\n    \r\n    return uri;\r\n}\r\n\r\nlet requests = {};\r\nlet lastRequestId = 0;\r\nlet uniquePrefix = `id${Math.random()}`;\r\n\r\nfunction processMessage (e) {\r\n    if (e.origin in requests) {\r\n        let dataStr = decodeURIComponent(e.data.replace(/\\n/g,'\\n\\\\'));\r\n        try {\r\n            let dataObj = JSON.parse(dataStr);\r\n            var request = requests[e.origin][dataObj.CallbackName];\r\n            if (request) {\r\n                delete requests[e.origin][dataObj.CallbackName];\r\n                request.iframe.parentNode.removeChild(request.iframe);\r\n                request.callback && request.callback(dataObj);\r\n            }\r\n        }\r\n        catch (e) { }\r\n    }    \r\n}\r\n\r\n//совместимость с IE8\r\nif (window.addEventListener) {\r\n    window.addEventListener('message', processMessage);\r\n} else {\r\n    window.attachEvent('onmessage', processMessage);\r\n}\r\n\r\nfunction addQueryVariables (url, variables) {\r\n    let oldQueryString = url.split('?')[1];\r\n    let newQueryString = '';\r\n    for (let variable in variables) {\r\n        if (variables.hasOwnProperty(variable)) {\r\n            newQueryString += ('&' + variable + '=' + encodeURIComponent(variables[variable]));\r\n        }\r\n    }\r\n    if (oldQueryString) {\r\n        return url + newQueryString;\r\n    } else {\r\n        return url + '?' + newQueryString.slice(1);\r\n    }\r\n}\r\n\r\nfunction createPostIframe(id)\r\n{\r\n    var iframe = document.createElement(\"iframe\");\r\n    iframe.style.display = 'none';\r\n    iframe.setAttribute('id', id);\r\n    iframe.setAttribute('name', id);\r\n    iframe.src = 'javascript:true';\r\n    \r\n    return iframe;\r\n}\r\n\r\nclass Server {\r\n    constructor({root}) {\r\n        this._root = root;\r\n    }\r\n\r\n    /** Послать GET запрос к серверу ресурсов.\r\n     * @param  {String} url\r\n     * @param  {Object} params\r\n     * @return {Function} promise(data)\r\n     */\r\n    sendGetRequest (url, params) {\r\n        return new Promise((resolve, reject) => {\r\n            let requestUrl = `${this._root}/${url}`;\r\n            requestUrl = addQueryVariables(requestUrl, params);\r\n            sendCrossDomainJSONRequest(requestUrl, data => resolve(data), 'CallbackName', errors => reject({ Status: 'error' }));           \r\n        });        \r\n    }\r\n        \r\n    /** Послать к серверу ресурсов запрос за картинкой.\r\n     * @param  {String} url\r\n     * @param  {Object} params\r\n     * @return {Function} promise(image)\r\n     */\r\n    sendImageRequest (url, params) {            \r\n        let requestUrl = `${this._root}/${url}`;\r\n        requestUrl = addQueryVariables(requestUrl, params);\r\n        \r\n        var img = new Image();\r\n        \r\n        img.onload = () => resolve({ Status: 'ok', Result: img });\r\n        img.onerror = errors => reject(errors);            \r\n        img.src = requestUrl;\r\n    }\r\n\r\n    /** Послать POST запрос к серверу ресурсов.\r\n     * @param  {String} url\r\n     * @param  {Object} params\r\n     * @param  {HTMLFormElement} baseForm HTML Form, которая может быть использована как основа для посылки запроса (например, если нужно загрузить файл)\r\n     * @return {Function} promise(data)\r\n     */\r\n    sendPostRequest (url, params, baseForm) {\r\n        let requestURL = `${this._root}/${url}`;            \r\n        return new Promise((resolve, reject) => {\r\n            let processResponse = (response) => {\r\n                if (response.Status !== 'ok') {\r\n                    reject(response);\r\n                } else {\r\n                    resolve(response);\r\n                }\r\n            };\r\n\r\n            try {\r\n                \r\n                let id = `${uniquePrefix}${lastRequestId++}`;\r\n                let iframe = createPostIframe(id);\r\n                let parsedURL = parseUri(requestURL);\r\n                let origin = (parsedURL.protocol ? `${parsedURL.protocol}:` : window.location.protocol) + `//${parsedURL.host || window.location.host}`;\r\n                let originalFormAction;\r\n                let form;\r\n                \r\n                requests[origin] = requests[origin] || {};\r\n                requests[origin][id] = {callback: processResponse, iframe: iframe};\r\n                    \r\n                if (baseForm)\r\n                {\r\n                    form = baseForm;\r\n                    originalFormAction = form.getAttribute('action');\r\n                    form.setAttribute('action', requestURL);\r\n                    form.target = id;                \r\n                }\r\n                else\r\n                {\r\n                    form = document.createElement('form');\r\n                    form.style.display = 'none';\r\n                    form.setAttribute('enctype', 'multipart/form-data');\r\n                    form.target = id;\r\n                    form.setAttribute('method', 'POST');\r\n                    form.setAttribute('action', requestURL);\r\n                    form.id = id;\r\n                }\r\n                \r\n                let hiddenParamsDiv = document.createElement(\"div\");\r\n                hiddenParamsDiv.style.display = 'none';\r\n                \r\n                let appendFormParam = function(paramName, paramValue) { \r\n                    let input = document.createElement(\"input\");            \r\n                    paramValue = typeof paramValue !== 'undefined' ? paramValue : '';\r\n                    \r\n                    input.setAttribute('type', 'hidden');\r\n                    input.setAttribute('name', paramName);\r\n                    input.setAttribute('value', paramValue);\r\n                    \r\n                    hiddenParamsDiv.appendChild(input)\r\n                }\r\n                \r\n                for (let paramName in params) {\r\n                    appendFormParam(paramName, params[paramName]);\r\n                }\r\n                \r\n                appendFormParam('WrapStyle', 'message');\r\n                appendFormParam('CallbackName', id);\r\n                \r\n                form.appendChild(hiddenParamsDiv);\r\n                \r\n                if (!baseForm)\r\n                    document.body.appendChild(form);\r\n                    \r\n                document.body.appendChild(iframe);\r\n                \r\n                form.submit();\r\n                \r\n                if (baseForm)\r\n                {\r\n                    form.removeChild(hiddenParamsDiv);\r\n                    if (originalFormAction !== null)\r\n                        form.setAttribute('action', originalFormAction);\r\n                    else\r\n                        form.removeAttribute('action');\r\n                }\r\n                else\r\n                {\r\n                    form.parentNode.removeChild(form);\r\n                }\r\n            }\r\n            catch (e) {\r\n                reject(e);\r\n            }\r\n            \r\n        });                                    \r\n    }\r\n}\r\n\r\nexport default Server;","import Server from './Server.js';\r\n\r\nclass ResourceServer extends Server {\r\n    constructor(authManager, {id, root}){\r\n        super({root});\r\n        this._id = id;        \r\n        this._authManager = authManager;\r\n        this._authManager.$addResourceServer(this);     \r\n    }    \r\n    sendGetRequest (url, params, baseForm) {\r\n        params = params || {};\r\n        params.sync = this._authManager.$getAntiCsrfToken();\r\n        return new Promise ((resolve, reject) => {\r\n            super.sendGetRequest(url, params, baseForm)\r\n            .then(data => {\r\n                data.Service = { ServerId: this._id };            \r\n                if (data.Status === 'ok') {\r\n                    resolve(data);\r\n                } else {\r\n                    reject(data);\r\n                }\r\n            })\r\n            .catch(errors => reject({ Status: 'error', ErrorInfo: errors.ErrorInfo }));\r\n        });  \r\n    }\r\n    sendImageRequest (url, params, baseForm) {\r\n        params = params || {};\r\n        params.sync = this._authManager.$getAntiCsrfToken();\r\n        return new Promise ((resolve, reject) => {\r\n            super.sendImageRequest(url, params, baseForm)\r\n            .then(data => {\r\n                data.Service = { ServerId: this._id };            \r\n                if (data.Status === 'ok') {\r\n                    resolve(data);\r\n                } else {\r\n                    reject(data);\r\n                }\r\n            })\r\n            .catch(errors => reject({ Status: 'error', ErrorInfo: errors.ErrorInfo }));\r\n        });  \r\n    }\r\n    sendPostRequest (url, params, baseForm) {\r\n        params = params || {};\r\n        params.sync = this._authManager.$getAntiCsrfToken();\r\n        return new Promise ((resolve, reject) => {\r\n            super.sendPostRequest(url, params, baseForm)\r\n            .then(data => {\r\n                data.Service = { ServerId: this._id };            \r\n                if (data.Status === 'ok') {\r\n                    resolve(data);\r\n                } else {\r\n                    reject(data);\r\n                }\r\n            })\r\n            .catch(errors => reject({ Status: 'error', ErrorInfo: errors.ErrorInfo }));\r\n        });  \r\n    }\r\n}\r\n\r\nexport default ResourceServer;","import ResourceServer from './ResourceServer.js';\r\nimport AuthManager from './AuthManager.js';\r\n\r\nlet resourceServersInstances = {};\r\nlet resourceServersConstructors = {};\r\nlet authManager;\r\n\r\n// строка, в которой перечислены псевдонимы используемых нами серверов ресурсов.\r\n// потребуется для синхронизации серверов ресурсов\r\nlet scope;\r\n\r\n// зашиваем известные и часто-используемые ресурсы\r\nresourceServersConstructors['subscriptions'] = () => {\r\n    return new ResourceServer(authManager, {\r\n        id: 'subscriptions',\r\n        root: '//fires.kosmosnimki.ru/SAPIv2'\r\n    });\r\n};\r\n\r\nresourceServersConstructors['geomixer2'] = () => {\r\n    return new ResourceServer(authManager, {\r\n        id: 'geomixer2',\r\n        root: '//maps2.kosmosnimki.ru'\r\n    });\r\n};\r\n\r\nresourceServersConstructors['geomixer'] = () => {\r\n    return new ResourceServer(authManager, {\r\n        id: 'geomixer',\r\n        root: '//maps.kosmosnimki.ru'\r\n    });\r\n};\r\n\r\nresourceServersConstructors['geocode'] = () => {\r\n    return new ResourceServer(authManager, {\r\n        id: 'geocode',\r\n        root: '//geocode.kosmosnimki.ru'\r\n    });\r\n};\r\n\r\nfunction getResourceServer (id) {\r\n    if (!authManager) {\r\n        authManager = getAuthManager();\r\n    }\r\n    // используем lazy instantiation для отложенного создания\r\n    // необходимых нам компонентов\r\n    if (!resourceServersInstances[id]) {\r\n        resourceServersInstances[id] = resourceServersConstructors[id]();\r\n        if (!scope) {\r\n            scope = id;\r\n        } else {\r\n            scope += (',' + id);\r\n        }\r\n    }\r\n    return resourceServersInstances[id];\r\n}\r\n\r\nfunction getAuthManager () {\r\n    // то же и с authManager\r\n    if (!authManager) {\r\n        authManager = new AuthManager({\r\n            authorizationEndpoint: '//my.kosmosnimki.ru/Test/LoginDialog',\r\n            userInfoEndpoint: '//my.kosmosnimki.ru/oAuth/LoginDialog',\r\n            redirectEndpointHtml: location.href.replace(/[^\\/]+$/, '') + 'oAuth2/oAuthCallback.htm',\r\n            redirectEndpointAshx: location.href.replace(/[^\\/]+$/, '') + 'oAuth2/oAuthCallback.ashx',\r\n            credentialLoginEndpoint: '//my.kosmosnimki.ru/Handler/Login'\r\n        });\r\n    }\r\n    return authManager;\r\n}\r\n\r\nexport { getAuthManager, getResourceServer };","const chain = (tasks, state) => {\r\n    return tasks.reduce(\r\n        (prev, next) => prev.then(next),\r\n        new Promise ((resolve, reject) => resolve (state))\r\n    );\r\n};\r\n\r\nexport { chain };","const HOME_LINK = '//my.kosmosnimki.ru/Home/Settings';\r\n\r\nconst ACCESS_LAYER_ID = '9077D16CFE374967A8C57C78095F34EA';\r\nconst ACCESS_USER_ROLE = 'scanex';\r\n\r\nconst LOCAL_STORAGE_KEY = 'view_state';\r\n\r\nconst RESULT_MAX_COUNT = 1000;\r\nconst RESULT_MAX_COUNT_PLUS_ONE = 1001;\r\n\r\nconst MAX_CART_SIZE = 200;\r\n\r\nconst MAX_UPLOAD_OBJECTS = 200;\r\nconst MAX_UPLOAD_POINTS = 100000;\r\n\r\nconst VERSION = '2.2.5';\r\nconst VERSION_DATE = new Date(2018, 6, 27);\r\n\r\nconst LAYER_ID = '9B4733A8CBE942CE9F5E70DCAA6C1FBE'; // 'AFB4D363768E4C5FAC71C9B0C6F7B2F4'\r\n\r\nconst DEFAULT_LANGUAGE = 'rus';\r\n\r\nconst NON_EDIT_LINE_STYLE = {\r\n    fill: false,\r\n    weight: 2,\r\n    opacity: 1\r\n};\r\n\r\nconst TAB_SEARCH_NAME = 'search';\r\nconst TAB_RESULTS_NAME = 'results';\r\nconst TAB_FAVORITES_NAME = 'favorites';\r\n\r\nconst VERSION_PATH = 'dist/version-';\r\n\r\nconst NOTIFICATION_HIDE_TIMEOUT = 2000;\r\n\r\nconst MAP_CONTAINER_ID = 'map';\r\n\r\nconst MAP_INIT_SETTINGS = {\r\n    center: new L.LatLng(55.634508, 37.433167),\r\n    minZoom: 1,\r\n    maxZoom: 17,\r\n    zoom: 3,\r\n    boxZoom: false,\r\n    srs: 3857,\r\n    skipTiles: 'All',\r\n    ftc: 'osm',\r\n    attributionControl: false,\r\n    zoomControl: false,\r\n    squareUnit: 'km2',\r\n    distanceUnit: 'km', \r\n    maxBounds: L.latLngBounds(L.latLng(-100, -360), L.latLng(100, 360)),\r\n};\r\n\r\nconst MAP_SVG_SPRITE = false;\r\n\r\nconst LOAD_MAP_ID = '1CB019F36D024831972F3029B724D7CA';\r\n\r\nconst LOAD_MAP_PARAMS = {\r\n    apiKey: 'Z2SSNR87N4', //'A07FEB777402A559A7DE8BC6CA7C2E96',\r\n    srs: 3857,\r\n    skipTiles: 'All',\r\n    ftc: 'osm',\r\n};\r\n\r\nconst EAST_HEMISPHERE = L.bounds(\r\n    L.point(0, -90), \r\n    L.point(180, 90)\r\n);\r\n\r\nconst WEST_HEMISPHERE = L.bounds(\r\n    L.point(180, -90),\r\n    L.point(360, 90)\r\n);\r\n\r\nconst WEST_HEMISPHERE2 = L.bounds(\r\n    L.point(-180, -90),\r\n    L.point(0, 90)\r\n);\r\n\r\nconst QUICKLOOK = {\r\n    url: '//search.kosmosnimki.ru/QuickLookImage.ashx',\r\n    width: 600,\r\n    height: 600\r\n};\r\n\r\nconst PANCHROME_IDS = [/*'WV01',*/ 'RP_PC', 'SP5_5PC', 'EROSB', 'EROSA'];\r\n\r\nexport {\r\n    HOME_LINK,\r\n    ACCESS_LAYER_ID,\r\n    ACCESS_USER_ROLE,\r\n    LOCAL_STORAGE_KEY,\r\n    RESULT_MAX_COUNT,\r\n    RESULT_MAX_COUNT_PLUS_ONE,\r\n    MAX_CART_SIZE,\r\n    MAX_UPLOAD_POINTS,\r\n    MAX_UPLOAD_OBJECTS,\r\n    VERSION, VERSION_DATE,\r\n    LAYER_ID,\r\n    DEFAULT_LANGUAGE,\r\n    NON_EDIT_LINE_STYLE,\r\n    VERSION_PATH,\r\n    TAB_SEARCH_NAME,\r\n    TAB_RESULTS_NAME,\r\n    TAB_FAVORITES_NAME,\r\n    NOTIFICATION_HIDE_TIMEOUT,\r\n    MAP_CONTAINER_ID,\r\n    MAP_INIT_SETTINGS,\r\n    MAP_SVG_SPRITE,\r\n    LOAD_MAP_ID,\r\n    LOAD_MAP_PARAMS,\r\n    EAST_HEMISPHERE,\r\n    WEST_HEMISPHERE,\r\n    WEST_HEMISPHERE2,\r\n    QUICKLOOK,\r\n    PANCHROME_IDS\r\n};","import Translations from 'scanex-translations';\r\n\r\n\r\nclass Satellite {\r\n    constructor({id, platforms, name, resolution, swath, operator, since, ms = true, arity = 1, restricted = false, checked = false, endingDate = null}) {\r\n        this._id = id;\r\n        this._platforms = platforms;\r\n        this._name = name;\r\n        this._resolution = resolution;\r\n        this._swath = swath;\r\n        this._operator = operator;\r\n        this._since = since;\r\n        this._arity = arity;\r\n        this._ms = ms;\r\n        this._restricted = restricted;\r\n        this._checked = checked;\r\n        this._endingDate = endingDate;\r\n    }\r\n    get id() {\r\n        return this._id;\r\n    }\r\n    get platforms() {\r\n        return this._platforms;\r\n    }\r\n    get name() {\r\n        return this._name;\r\n    }\r\n    get resolution() {\r\n        return this._resolution;\r\n    }\r\n    get swath() {\r\n        return this._swath;\r\n    }\r\n    get operator() {\r\n        return this._operator;\r\n    }\r\n    get since() {\r\n        return this._since;\r\n    }\r\n    get arity(){\r\n        return this._arity;\r\n    }\r\n    get ms() {\r\n        return this._ms;\r\n    }\r\n    get restricted() {\r\n        return this._restricted;\r\n    }\r\n    get checked() {\r\n        return this._checked;\r\n    }\r\n    get endingDate() {\r\n        return this._endingDate;\r\n    }\r\n    set checked(value) {\r\n        this._checked = value;\r\n    }\r\n    set endingDate(value) {\r\n        this._endingDate = value;\r\n    }\r\n    islocal (archive) {\r\n        switch(archive){ \r\n            case 'global':\r\n                return ' AND islocal = FALSE';\r\n            case 'local':\r\n                return ' AND islocal = TRUE';\r\n            default:\r\n            case 'all':\r\n                return '';\r\n        }\r\n    }\r\n    condition (archive) {        \r\n        return `platform IN (${this.platforms.map(x => `'${x}'`).join(',')})${this.islocal(archive)}`;\r\n    }\r\n}\r\n\r\nclass DG extends Satellite{\r\n    constructor ({id, platforms, name, resolution, swath, since, ms, endingDate}){\r\n        super({id, platforms, name, resolution, swath, operator: Translations.getText('operator.dg'), since, ms, endingDate});\r\n    }\r\n    condition (archive) {\r\n\r\n        if (archive === 'local') {\r\n            return '';\r\n        }\r\n\r\n        return `platform IN (${this.platforms.map(x => `'${x}'`).join(',')}) AND islocal = FALSE`;\r\n    }\r\n}\r\n\r\nclass KOMPSAT extends Satellite {\r\n    constructor ({id, platforms, name, resolution, swath, since}){\r\n        super({id, platforms, name, resolution, swath, operator: Translations.getText('operator.siis'), since});\r\n    }\r\n}\r\n\r\nclass SpaceView extends Satellite {\r\n    constructor({id, platforms, name, resolution, swath, arity, since, restricted = true}){\r\n        super({id, platforms, name, resolution, swath, operator: Translations.getText('operator.spaceview'), arity, since, restricted});\r\n    }\r\n}\r\n\r\nclass GF1 extends SpaceView {\r\n    constructor({id, platforms, name, resolution, swath, since, sensor}){\r\n        super({id, platforms, name, resolution, swath, since});\r\n        this._sensor = sensor;\r\n        this._restricted = false;\r\n    }\r\n    get sensor() {\r\n        return this._sensor;\r\n    }\r\n    condition (archive) {\r\n        return `${super.condition(archive)} AND sensor = '${this.sensor}'`;\r\n    }\r\n}\r\n\r\nclass SV1 extends SpaceView {\r\n    constructor(){\r\n        super({id: 'SV1', platforms: ['GJ1A', 'GJ1B', 'GJ1C', 'GJ1D'], name: 'SuperView-1 01-04', resolution: 0.5, swath: 12, arity: 4, since: '26.12.2016, 09.01.2018'});\r\n        this._restricted = false;\r\n    }    \r\n}\r\n\r\nclass Airbus extends Satellite {\r\n    constructor({id, platforms, name, resolution, swath, since, arity, ms, endingDate}){\r\n        super({id, platforms, name, resolution, swath, operator: Translations.getText('operator.airbus'), since, arity, ms, endingDate});\r\n    }\r\n}\r\n\r\nclass PHR extends Airbus{\r\n    constructor(){\r\n        super({id: 'PHR', platforms: ['PHR1A','PHR1B','1A_PM','1B_PM','PHR-1A','PHR-1B'], name: 'Pléiades-1A/1B', resolution: 0.5, swath: 20, since: '2011, 2012', arity: 2});\r\n    }\r\n    condition (archive) {\r\n        switch (archive) {\r\n            case 'all':\r\n                return \"platform IN ('PHR1A','PHR1B','1A_PM','1B_PM','PHR-1A','PHR-1B')\";\r\n            case 'local':\r\n                return \"platform IN ('1A_PM','1B_PM','PHR-1A','PHR-1B')\";\r\n            case 'global':\r\n            default:\r\n                return super.condition(archive);\r\n        }\r\n    }\r\n}\r\n\r\nclass PLD_1A extends Airbus{\r\n    constructor(){\r\n        super({id: '1A_PHR', platforms: ['1A-PHR-1A','1A-PHR-1B'], name: '1ATLAS (PLD)', resolution: 0.5, swath: 20, since: '2011, 2012', arity: 2});\r\n    }\r\n    get restricted () {\r\n        return true;\r\n    }\r\n    condition (archive) {\r\n        return \"platform IN ('1A-PHR-1A','1A-PHR-1B')\";\r\n    }\r\n    \r\n}\r\n\r\nclass SP5_10MS extends Airbus {\r\n    constructor(){\r\n        super({id: 'SP5_10MS', platforms: ['SPOT 5'], name: 'SPOT 5 (10 м)', resolution: 10, swath: 20, since: '2002 - 2015', endingDate: '2015'});\r\n    }\r\n    condition (archive, authorized) {\r\n        return `platform = 'SPOT 5' AND sensor = 'J'${authorized ? this.islocal(archive) : ''}`;\r\n    }\r\n}\r\n\r\nclass SP5_5MS extends Airbus{\r\n    constructor(){\r\n        super({id: 'SP5_5MS', platforms: ['SPOT 5'], name: 'SPOT 5 (5 м)', resolution: 5, swath: 20, since: '2002 - 2015'});\r\n    }\r\n    condition (archive, authorized) {\r\n        return `platform = 'SPOT 5' AND (sensor = 'J' AND (spot5_a_exists = TRUE OR spot5_b_exists = TRUE))${authorized ? this.islocal(archive) : ''}`;\r\n    }\r\n}\r\n\r\nclass SP5_5PC extends SP5_5MS{\r\n    constructor(){\r\n        super();\r\n        this._id = 'SP5_5PC';\r\n        this._ms = false;\r\n    }\r\n    condition (archive, authorized) {\r\n        return `platform = 'SPOT 5' AND (sensor = 'A' OR sensor = 'B' AND spot5_b_exists = FALSE)${authorized ? this.islocal(archive) : ''}`;\r\n    }\r\n}\r\n\r\nclass SP5_2MS extends Airbus{\r\n    constructor(){\r\n        super({id: 'SP5_2MS', platforms: ['SPOT 5'], name: 'SPOT 5 (2.5 м)', resolution: 2.5, swath: 20, since: '2002 - 2015'});\r\n    }\r\n    condition (archive, authorized) {\r\n        return `platform = 'SPOT 5' AND sensor = 'J' AND spot5_a_exists = TRUE AND spot5_b_exists = TRUE${authorized ? this.islocal(archive) : ''}`;\r\n    }\r\n}\r\n\r\nclass SP5_2PC extends SP5_2MS{\r\n    constructor(){\r\n        super();\r\n        this._id = 'SP5_2PC';\r\n        this._ms = false;\r\n    }\r\n    condition (archive, authorized) {\r\n        return `platform = 'SPOT 5' AND sensor = 'A' AND spot5_b_exists = TRUE${authorized ? this.islocal(archive) : ''}`;\r\n    }\r\n}\r\n\r\nclass SP6_7 extends Airbus {\r\n    constructor(){\r\n        super({id: 'SP6_7', platforms: ['SPOT6','SPOT 6','SPOT7','SPOT 7'],  name: 'SPOT 6/7', resolution: 1.5, swath: 60, since: '2012, 2014', arity: 2});\r\n    }\r\n    condition(archive, authorized) {\r\n        return `platform IN ('SPOT6','SPOT 6','SPOT7','SPOT 7')${authorized ? this.islocal(archive) : ''}`;\r\n    }\r\n}\r\n\r\nclass SP6_7_1A extends Airbus {\r\n    constructor(){\r\n        super({id: '1A_SP6_7', platforms: ['1A-SPOT-6','1A-SPOT-7'],  name: '1ATLAS (SP)', resolution: 1.5, swath: 60, since: '2012, 2014', arity: 2});\r\n    }\r\n    get restricted () {\r\n        return true;\r\n    }\r\n    condition(archive, authorized) {\r\n        return \"platform IN ('1A-SPOT-6','1A-SPOT-7')\";\r\n    }\r\n}\r\n\r\nclass SP67_P extends Airbus {\r\n    constructor(){\r\n        super({id: 'SP67_P', platforms: ['SPOT-6','SPOT-7'],  name: 'SPOT-6/7-P', resolution: 1.5, swath: 60, since: '2012, 2014', arity: 2});\r\n    }\r\n    get restricted () {\r\n        return true;\r\n    }\r\n    condition(archive, authorized) {\r\n        return \"platform IN ('SPOT-6','SPOT-7') AND product = TRUE\";\r\n    }\r\n}\r\n\r\nclass EROS extends Satellite {\r\n    constructor({id, platforms, name, resolution, swath, since }){\r\n        super({id,  platforms, name, resolution, swath, operator: Translations.getText('operator.iinv'), restricted: true, since, ms: false });\r\n    }\r\n}\r\n\r\nclass RP extends Satellite {\r\n    constructor ({id, platforms, name, ms}) {\r\n        super ({id, platforms, name, resolution: 1, swath: 38, operator: Translations.getText('operator.roskosmos'), arity: 3, since: '2013, 2014, 2016', ms });\r\n        \r\n    }\r\n    condition (archive) {\r\n        return `${super.condition(archive)} AND sensor = 'СППИ \"Сангур-1У\"'`;\r\n    }\r\n}\r\n\r\nclass RP_PC extends RP {\r\n    constructor() {\r\n        super ({id: 'RP_PC', platforms: ['Ресурс-П1','Ресурс-П2','Ресурс-П3'], name: 'Ресурс-П', ms: false, });\r\n    }\r\n    condition (archive) {\r\n        return `${super.condition(archive)} AND spot5_a_exists = TRUE AND spot5_b_exists = FALSE`;\r\n    }\r\n}\r\n\r\nclass RP_1MS extends RP {\r\n    constructor() {\r\n        super ({id: 'RP_1MS', platforms: ['Ресурс-П1','Ресурс-П2','Ресурс-П3'], name: 'Ресурс-П 1-3 (1 м)', resolution: 1, ms: true, });\r\n    }\r\n    condition (archive) {\r\n        return `${super.condition(archive)} AND spot5_a_exists = TRUE AND spot5_b_exists = TRUE`;\r\n    }\r\n}\r\n\r\nclass RP_4MS extends RP {\r\n    constructor() {\r\n        super ({id: 'RP_4MS', platforms: ['Ресурс-П1','Ресурс-П2','Ресурс-П3'], name: 'Ресурс-П 1-3 (4 м)', resolution: 4, ms: true, });\r\n        this._resolution = 4;\r\n    }\r\n    condition (archive) {\r\n        return `${super.condition(archive)} AND spot5_b_exists = TRUE`;\r\n    }\r\n}\r\n\r\nclass Triplesat extends Satellite {\r\n    constructor () {\r\n        super({\r\n            id: '21AT',\r\n            platforms: ['TripleSat Constellation-1','TripleSat Constellation-2','TripleSat Constellation-3'],\r\n            name: 'TripleSat',\r\n            resolution: 1,\r\n            swath: 23,\r\n            arity: 3,\r\n            operator: Translations.getText('operator.twentyfirst'),\r\n            since: '2015',\r\n            ms: true,\r\n            restricted: false,\r\n        });\r\n    }    \r\n}\r\n\r\nconst satellites = {\r\n    ms: [\r\n        new DG({id: 'WV04', platforms: ['WV04'], name: 'WorldView-4', resolution: 0.3, swath: 13.2, since: '2016'}),\r\n        new DG({id: 'WV03', platforms: ['WV03'], name: 'WorldView-3', resolution: 0.3, swath: 13.1, since: '2014'}),\r\n        new DG({id: 'WV02', platforms: ['WV02'], name: 'WorldView-2', resolution: 0.4, swath: 16.4, since: '2009'}),\r\n        new DG({id: 'WV01', platforms: ['WV01'], name: 'WorldView-1', resolution: 0.5, swath: 17.6, since: '2007'}),\r\n        new DG({id: 'GE01', platforms: ['GE01'], name: 'GeoEye-1', resolution: 0.4, swath: 15.2, since: '2008'}),\r\n        new PHR(),\r\n        new DG({id: 'QB02', platforms: ['QB02'], name: 'QuickBird', resolution: 0.5, swath: 16.5, since: '2001 - 2015', endingDate: '2015'}),\r\n        new KOMPSAT({id: 'KOMPSAT3A', platforms: ['KOMPSAT3A'], name: 'KOMPSAT-3A', resolution: 0.5, swath: 12, since: '2015'}),\r\n        new KOMPSAT({id: 'KOMPSAT3', platforms: ['KOMPSAT3'], name: 'KOMPSAT-3', resolution: 0.7, swath: 16, since: '2012'}),\r\n        new SV1(),            \r\n        new Satellite({id: 'IK', platforms: ['IK-2','IKONOS-2'], name: 'IKONOS', resolution: 0.8, swath: 11.3, operator: Translations.getText('operator.ge'), since: '1999 - 2015', endingDate: '2015'}),\r\n        new SpaceView({id: 'GF2', platforms: ['GF2'], name: 'GaoFen-2', resolution: 0.8, swath: 45, since: '2014', restricted: false}),\r\n        new SpaceView({id: 'GF4', platforms: ['GF4'], name: 'GaoFen-4', resolution: 50, swath: 400, since: '2015', restricted: false}),\r\n        new KOMPSAT({id: 'KOMPSAT2', platforms: ['KOMPSAT2'], name: 'KOMPSAT-2', resolution: 1, swath: 15, since: '2006'}), \r\n        new Triplesat(),\r\n        new RP_1MS(),\r\n        new SP6_7(),\r\n        new Satellite({id: 'BKA', platforms: ['BKA'], name: 'БелКА', resolution: 2, swath: 20, operator: Translations.getText('operator.vniiem'), since: '2012', restricted: true}),\r\n        new GF1({id: 'GF1_2m', platforms: ['GF1'], name: 'Gaofen-1 (2 м)', resolution: 2, swath: 60, since: '2013', sensor: 'A'}),        \r\n        new SpaceView({id: 'ZY3', platforms: ['ZY3','ZY302'], name: 'ZiYuan 3', resolution: 2.1, swath: 51, since: '2012', restricted: false}),\r\n        // new SP5_2MS(),\r\n        new RP_4MS(),\r\n        // new SP5_5MS(),\r\n        new Satellite({id: 'RE', platforms: ['RE'], name: 'RapidEye', resolution: 6.5, swath: 77, operator: Translations.getText('operator.blackbridge'), since: '2008', restricted: true}),\r\n        new SP5_10MS(),\r\n        new Satellite({id: 'LANDSAT8', platforms: ['LANDSAT_8'], name: 'Landsat 8', resolution: 15, swath: 185, operator: Translations.getText('operator.usgs'), since: '2013', restricted: true}),\r\n        new GF1({id: 'GF1_16m', platforms: ['GF1'], name: 'Gaofen-1 (16 м)', resolution: 16, swath: 800, since: '2013', sensor: 'B'}),\r\n        new SP6_7_1A(),\r\n        new PLD_1A(),        \r\n        new SP67_P(),\r\n    ],\r\n    pc: [\r\n        //new DG({id: 'WV01', platforms: ['WV01'], name: 'WorldView-1', resolution: 0.5, swath: 17.6, since: '2007'}),\r\n        new EROS({id: 'EROSB', platforms: ['EROS-B'], name: 'EROS B', resolution: 0.7, swath: 7, since: '2006'}),        \r\n        new RP_PC(),\r\n        new EROS({id: 'EROSA', platforms: ['EROS-A1'], name: 'EROS A', resolution: 1.9, swath: 14, since: '2000'}),\r\n        // new SP5_2PC(),\r\n        new SP5_5PC(),        \r\n    ],\r\n};\r\n\r\nfunction get_name(a, x) {    \r\n    return x.platforms.reduce((b, y) => {\r\n        b[y] = x.name;\r\n        return b;\r\n    }, a);\r\n}\r\n\r\nlet names = satellites.ms.reduce(get_name, {});\r\nnames = satellites.pc.reduce(get_name, names);\r\n\r\nfunction getSatelliteName (platform) {    \r\n    return names[platform];\r\n}\r\n\r\nexport { satellites, getSatelliteName };","import Translations from 'scanex-translations';\r\n\r\nimport {\r\n    EAST_HEMISPHERE,\r\n    WEST_HEMISPHERE,\r\n    WEST_HEMISPHERE2,\r\n    PANCHROME_IDS\r\n} from '../config/constants/Constants';\r\nimport { satellites } from '../config/satellites/Satellites';\r\n\r\n\r\nfunction hex (number, width = 6) {\r\n    let h = number.toString(16);\r\n    while (h.length < width) {\r\n        h = '0' + h;\r\n    }\r\n    return h.toUpperCase();\r\n}\r\n\r\nfunction unHex (str) {\r\n    return parseInt(str.substr(1), 16);\r\n}\r\n\r\nfunction isNumber(n) {\r\n    return !isNaN (new Number(n));\r\n}\r\n\r\nfunction isNumeric(n) {\r\n    return !isNaN(parseFloat(n)) && isFinite(n);\r\n  }\r\n\r\nfunction createContainer () {\r\n\r\n    const container = document.createElement('div');\r\n    document.body.appendChild(container);\r\n    return container;\r\n}\r\n\r\nfunction getWindowCenter () {\r\n\r\n    const {left, top, width, height} = document.body.getBoundingClientRect();\r\n    return {left: left + Math.round (width / 2), top: top + Math.round(height / 2)};\r\n}\r\n\r\nfunction getMapCenter () {\r\n\r\n    const headerBounds = document.getElementById('header').getBoundingClientRect();\r\n    const {top, left} = getWindowCenter ();\r\n    return {top: top + headerBounds.top + headerBounds.height, left};\r\n}\r\n\r\nfunction isMobile () {\r\n\r\n    let browserCheckString = navigator.userAgent || navigator.vendor || window.opera;\r\n    let stringSubstr = browserCheckString.substr(0,4);\r\n\r\n    return /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(browserCheckString) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(stringSubstr);\r\n}\r\n\r\nfunction _f (arr, acc, swap) {\r\n    if (arr.length) {\r\n        let r = [];\r\n        for (let i = 0, len = arr.length; i < len; i++) {\r\n            let a = arr[i];\r\n            if (_f(a, acc, swap)) {\r\n                if (swap) {\r\n                    r.unshift(a);\r\n                }\r\n                else {\r\n                    r.push(a);\r\n                }\r\n            }\r\n        }\r\n        if (r.length) {\r\n            acc.push(r);\r\n        }\r\n        return false;\r\n    }\r\n    else {\r\n        return true;\r\n    }\r\n}\r\n\r\nfunction flatten (arr, swap) {\r\n    let acc = [];\r\n    _f(arr, acc, swap);\r\n    return acc;\r\n}\r\n\r\nfunction getTotalHeight (parts) {\r\n    return parts.reduce((a, x) => a + document.body.querySelector(x).getBoundingClientRect().height, 0);\r\n};\r\n\r\nfunction uppercaseFirstLetter(stringValue) {\r\n\r\n    if (typeof stringValue !== 'string') return ''\r\n    return stringValue.charAt(0).toUpperCase() + stringValue.slice(1)\r\n}\r\n\r\nfunction makeCloseTo (lng, x) {\r\n    let dist = (a,b) => Math.abs (a - b);\r\n    let {p} = [x - 360, x, x + 360]\r\n    .map(p => {\r\n        return {p, d: dist (lng, p)};\r\n    })\r\n    .reduce((a,{p,d}) => {\r\n        if (a === null || d < a.d) {\r\n            a = {d, p};\r\n        }\r\n        return a;\r\n    }, null);\r\n    return p;\r\n}\r\n\r\nfunction stRange (start, end, boxes) {            \r\n    let rng = [];\r\n    let lo = getQuarters (start);\r\n    let hi = getQuarters (end);\r\n    for (let i = lo; i <= hi; i++) {\r\n        boxes.forEach (box => {\r\n            tileRange (i, box).forEach (n => rng.push(n));\r\n        });        \r\n    }\r\n    return rng;\r\n}\r\n\r\nfunction toQuery (range) {    \r\n    return `${range.length > 0 ? `stidx IN (${range.join(',')})` : '' }`;\r\n}\r\n\r\nfunction getQuarters (date) {\r\n    return (date.getFullYear() - 1970) * 4 + Math.ceil ((date.getMonth() + 1) / 3);\r\n}\r\n\r\nfunction getSatelliteName (platform) {\r\n\r\n    const getName = (a, x) => {    \r\n        return x.platforms.reduce((b, y) => {\r\n            b[y] = x.name;\r\n            return b;\r\n        }, a);\r\n    };\r\n\r\n    let names = satellites.ms.reduce(getName, {});\r\n    names = satellites.pc.reduce(getName, names);\r\n\r\n    return names[platform];\r\n}\r\n\r\nfunction createDefaultCriteria() {\r\n\r\n    const setSatellitesChecked = (group, flag) => {\r\n        for (let key in group) {      \r\n            let s = group[key];\r\n            if (s['resolution'] <= 0.5 && PANCHROME_IDS.indexOf(s['id']) === -1) {\r\n                s['checked'] = flag;\r\n            }\r\n        }\r\n    };\r\n\r\n    const now = getNowDate();\r\n\r\n    const dateStart = new Date(now.getFullYear(), 0, 1);\r\n    const dateEnd = now;\r\n\r\n    setSatellitesChecked(satellites.ms, true);\r\n    setSatellitesChecked(satellites.pc, true);\r\n\r\n    const defaultCriteria = {\r\n        date: [ dateStart, dateEnd ],\r\n        annually: false,\r\n        clouds: [0, 100],\r\n        angle: [0, 80],\r\n        resolution: [0.3, 20],\r\n        satellites: satellites,\r\n        stereo: false,\r\n        archive: 'global'\r\n    };\r\n\r\n    return defaultCriteria;\r\n}\r\n\r\nfunction createDefaultFilter() {\r\n\r\n    const now = getNowDate();\r\n    const dateStart = new Date(now.getFullYear(), 0, 1);\r\n    const dateEnd = now;\r\n\r\n    return {\r\n        date:  [ dateStart, dateEnd ],\r\n        clouds: [0, 100],\r\n        angle: [0, 80],\r\n        unChecked: []\r\n    };\r\n}\r\n\r\nfunction getPanelHeight (container, parts) {\r\n\r\n    return parts.reduce((a,x) => {\r\n        return a - container.querySelector(x).getBoundingClientRect().height;\r\n    }, container.getBoundingClientRect().height);\r\n}\r\n\r\nfunction splitComplexId (complexId) {\r\n\r\n    let separatorIndex = complexId.lastIndexOf('!');\r\n    return separatorIndex > 0\r\n        ? { id: complexId.substring(0, separatorIndex),\r\n            productId: complexId.substring(separatorIndex + 1, complexId.length)\r\n        }\r\n        : { id: complexId };\r\n}\r\n\r\nfunction fromGmx ({fields, values, types}, convertMercator = true) {\r\n\r\n    return values.map(x => {\r\n        let item = fields.reduce((a, k, i) => {\r\n            switch(types[i]){\r\n                default:                    \r\n                    a[k] = x[i];\r\n                    break;                   \r\n                case 'date':\r\n                    switch (typeof x[i]) {\r\n                        case 'string':\r\n                            a[k] = new Date(x[i]);\r\n                            break;\r\n                        case 'number':\r\n                            a[k] = new Date(x[i] * 1000);\r\n                            break;\r\n                        default:\r\n                            break;\r\n                    }                    \r\n                    break;\r\n                case 'time':\r\n                    break;\r\n                case 'geometry':\r\n                    a[k] = L.gmxUtil.geometryToGeoJSON(x[i], convertMercator);\r\n                    break;\r\n            }\r\n            switch (k) {\r\n                case 'stereo':\r\n                    const s = x[i];\r\n                    a.stereo = typeof s === 'string' && s !== 'NONE';\r\n                    break;                    \r\n                default:\r\n                    break;\r\n            }\r\n            return a;                    \r\n        }, {});\r\n        if (item.geomixergeojson) {\r\n            item.geoJSON = item.geomixergeojson;\r\n            delete item.geomixergeojson;\r\n        }        \r\n        item.url = `//search.kosmosnimki.ru/QuickLookImage.ashx?id=${item.sceneid}`;\r\n        return item;\r\n    });    \r\n}\r\n\r\nfunction getDrawingObject (rawObject) {\r\n\r\n    const { id, name, geoJSON, color, visible } = rawObject;\r\n\r\n    const correctId = id || L.gmxUtil.newId();\r\n    const correctName = (name === null || typeof name === 'undefined') ? getDrawingObjectName(geoJSON) : decodeURIComponent(name);\r\n    const GeoJSON = {\r\n        type: 'Feature',\r\n        geometry: L.gmxUtil.geometryToGeoJSON(geoJSON.geometry),\r\n        properties: geoJSON.properties\r\n    };\r\n    const isVisible = typeof visible === 'undefined' ? true : Boolean(visible);\r\n    const isEditable = typeof geoJSON.properties.editable === 'undefined' ? true : geoJSON.properties.editable;\r\n\r\n    let correctColor;\r\n    if (geoJSON.geometry.type === 'Point') {\r\n        correctColor = undefined;\r\n    }\r\n    else {\r\n        if (typeof color === 'undefined') {\r\n            correctColor = '#0033FF';\r\n        }\r\n        else {\r\n            if (isNaN (parseInt(color, 10))) {\r\n                correctColor = color;\r\n            }\r\n            else {\r\n                correctColor = `#${hex(color)}`;\r\n            }\r\n        }\r\n    }\r\n\r\n    return {\r\n        id: correctId,\r\n        name: correctName,\r\n        area: getDrawingObjectArea(geoJSON),            \r\n        geoJSON:  GeoJSON,\r\n        visible: isVisible,\r\n        color: correctColor,\r\n        editable: isEditable\r\n    };\r\n}\r\n\r\nfunction getDrawingObjectArea(geoJSON) {\r\n\r\n    const {geometry: {type,coordinates}} = geoJSON;\r\n\r\n    if (typeof coordinates !== 'undefined') {\r\n\r\n        switch (type.toUpperCase()) {\r\n            case 'POINT':\r\n                return 0;\r\n            case 'LINESTRING':\r\n            case 'MULTILINESTRING':\r\n                return L.gmxUtil.geoJSONGetLength(geoJSON);\r\n            case 'MULTIPOLYGON':\r\n            case 'POLYGON':\r\n            default:\r\n                return L.gmxUtil.geoJSONGetArea(geoJSON);\r\n        }\r\n    }\r\n}\r\n\r\nfunction getDrawingObjectName(geoJSON) {\r\n\r\n    if(geoJSON.properties.name) {\r\n        return geoJSON.properties.name;\r\n    }\r\n    else {\r\n        const type = geoJSON.geometry.type;\r\n\r\n        switch (type.toUpperCase()) {\r\n            case 'POINT':\r\n                return Translations.getText('objects.point');\r\n            case 'LINESTRING':\r\n            case 'MULTILINESTRING':\r\n                return Translations.getText('objects.line');\r\n            case 'MULTIPOLYGON':\r\n            case 'POLYGON':\r\n            default:\r\n                return Translations.getText('objects.polygon');\r\n        }         \r\n    }\r\n}\r\n\r\nfunction splitOn180 (geometry) {\r\n\r\n    const {type, coordinates} = geometry;\r\n\r\n    const splitCoordinates = (points, hemisphere) => {\r\n\r\n        let coords = L.PolyUtil.clipPolygon(points, hemisphere).map(({x,y}) => [x,y]);\r\n        if (coords.length > 0) {\r\n            let start_point = coords[0];\r\n            let end_point = coords[coords.length - 1];\r\n            if (start_point[0] != end_point[0] || start_point[1] != end_point[1]) {\r\n                coords.push(start_point);\r\n            }\r\n        }\r\n        return coords;\r\n    };\r\n\r\n    let geometries = [];\r\n\r\n    switch(type.toUpperCase()) {\r\n        case 'POLYGON':\r\n            const points = coordinates[0].map(([x,y]) => L.point(x,y));\r\n            let c1 =  splitCoordinates(points, EAST_HEMISPHERE);\r\n            if (c1.length > 0) {\r\n                geometries.push(normalizeGeometry ({type, coordinates: [c1]}, 179));\r\n            }            \r\n            let c2 = splitCoordinates(points, WEST_HEMISPHERE);\r\n            if (c2.length > 0) {\r\n                geometries.push(normalizeGeometry ({type, coordinates: [c2]}, -179));\r\n            }\r\n            else {\r\n                c2 = splitCoordinates(points, WEST_HEMISPHERE2);\r\n                if (c2.length > 0) {\r\n                    geometries.push(normalizeGeometry ({type, coordinates: [c2]}, -179));\r\n                }\r\n            }\r\n            break;\r\n        case 'LINESTRING':            \r\n        default:\r\n            geometries.push(geometry);\r\n            break;\r\n    }\r\n    return geometries;\r\n}\r\n\r\nfunction isGeometry(obj) {\r\n\r\n    const {type} = obj;\r\n\r\n    switch (type) {\r\n        case 'Point':\r\n        case 'MultiPoint':\r\n        case 'LineString':\r\n        case 'MultiLineString':\r\n        case 'Polygon':\r\n        case 'MultiPolygon':\r\n        case 'GeometryCollection':\r\n            return true;\r\n        default:\r\n            return false;\r\n    }    \r\n}\r\n\r\nfunction isGeojsonFeature (obj) {\r\n\r\n    let {type, geometry} = obj;\r\n\r\n    if(type !== 'Feature') {\r\n        console.log('geojson feature test failed: provided type is not a \"Feature\" object', obj);\r\n        return false;\r\n    }\r\n\r\n    if(!isGeometry(geometry)) {\r\n        console.log('geojson feature test failed: geometry is of wrong type', geometry);\r\n        return false;\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction normalizeGeometry (geometry, lng) {\r\n\r\n    let {type, coordinates} = geometry;\r\n\r\n    const x = isNumber(lng) ? lng : getRefLon(coordinates);\r\n\r\n    switch (type.toUpperCase()) {\r\n        case 'POLYGON':\r\n            return {type, coordinates: normalizePolygon(x, coordinates)};\r\n        case 'MULTIPOLYGON':\r\n            return {type, coordinates: coordinates.map(normalizePolygon.bind(null, x))};\r\n        default:\r\n            return geometry;\r\n    }\r\n}\r\n\r\nfunction normalizeGeometryType (geometry) {\r\n\r\n    let {type} = geometry;\r\n\r\n    switch (type.toUpperCase()) {\r\n        case 'POINT':\r\n            geometry.type = 'Point';\r\n            break;\r\n        case 'MULTIPOINT':\r\n            geometry.type = 'MultiPoint';\r\n            break;\r\n        case 'LINESTRING':\r\n            geometry.type = 'LineString';\r\n            break;\r\n        case 'MULTILINESTRING':\r\n            geometry.type = 'MultiLineString';\r\n            break;\r\n        case 'POLYGON':\r\n            geometry.type = 'Polygon';\r\n            break;\r\n        case 'MULTIPOLYGON':\r\n            geometry.type = 'MultiPolygon';\r\n            break;\r\n        case 'GEOMETRYCOLLECTION':\r\n            geometry.type = 'GeometryCollection';\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    return geometry;\r\n}\r\n\r\nfunction normalizePoint (lng, [x,y]) {\r\n\r\n    return [makeCloseTo(lng, x),y];\r\n}\r\n\r\nfunction normalizeRing (lng, coordinates) {\r\n\r\n    return coordinates.map(normalizePoint.bind(null, lng));\r\n}\r\n\r\nfunction normalizePolygon (lng, coordinates) {\r\n\r\n    if (isNumber (lng)) {\r\n        return coordinates.map(normalizeRing.bind(null, lng));\r\n    }\r\n    else {\r\n        return coordinates.map(normalizeRing.bind(null, getRefLon(coordinates)));\r\n    }\r\n}\r\n\r\nfunction getRefLon (coordinates) {\r\n\r\n    let f = flatten(coordinates);\r\n    let pos = f.filter(([x,y]) => x >= 0);\r\n    let [x,y] = pos.length > 0 ? pos[0] : f[0];\r\n    return x;    \r\n}\r\n\r\nfunction getBbox (geometry) {\r\n    let {type, coordinates} = geometry;\r\n    let lon = 0, lat = 0;\r\n    let sorter = (a,b)=> {\r\n        if (a > b) {\r\n            return 1;\r\n        }\r\n        if (a < b) {\r\n            return -1;\r\n        }            \r\n        return 0;\r\n    };\r\n    let rings = coords => {\r\n        let {xs, ys} = coords.reduce((a, [x, y]) => {        \r\n            a.xs.push (x);\r\n            a.ys.push (y);\r\n            return a;\r\n        }, {xs:[],ys:[]});        \r\n        xs = xs.sort(sorter);\r\n        ys = ys.sort(sorter);\r\n        let xmin = xs[0];\r\n        let xmax = xs[xs.length - 1];\r\n        let ymin = ys[0];\r\n        let ymax = ys[ys.length - 1];\r\n        return [[xmin,ymax],[xmax,ymax],[xmax,ymin],[xmin,ymin]];\r\n    };\r\n    switch (type.toUpperCase()) {\r\n        case 'POINT':\r\n            [lon, lat] = coordinates;\r\n            return [[lon,lat],[lon,lat],[lon,lat],[lon,lat]];\r\n        case 'MULTIPOINT':\r\n        case 'LINESTRING':\r\n            return rings (coordinates);\r\n        case 'POLYGON':\r\n        case 'MULTILINESTRING':\r\n            return rings (coordinates[0]);        \r\n        case 'MULTIPOLYGON':\r\n            let {xs, ys} = coordinates.reduce ((a, coords) => {\r\n                let [[x1,y1],[x2,y2],[x3,y3],[x4,y4]] = rings (coords[0]);\r\n                a.xs.push (x1);\r\n                a.xs.push (x2);\r\n                a.xs.push (x3);\r\n                a.xs.push (x4);\r\n                a.ys.push (y1);\r\n                a.ys.push (y2);\r\n                a.ys.push (y3);\r\n                a.ys.push (y4);\r\n                return a;\r\n            }, {xs: [], ys: []});\r\n            xs = xs.sort(sorter);\r\n            ys = ys.sort(sorter);\r\n            let xmin = xs[0];\r\n            let xmax = xs[xs.length - 1];\r\n            let ymin = ys[0];\r\n            let ymax = ys[ys.length - 1];\r\n            return [[xmin,ymax],[xmax,ymax],[xmax,ymin],[xmin,ymin]];                        \r\n        default:\r\n            return null;\r\n    }\r\n}\r\n\r\nfunction sti (period, lon, lat) {\r\n    return 65536 * period + 256 * Math.round(256 * (90 - lat) / 180) + Math.round(256 * (lon + 180) / 360);\r\n}\r\n\r\nfunction step  (lat) {\r\n    return lat < 50 ? 1 : (50 <= lat && lat <= 70 ? 2 : 3);\r\n}\r\n\r\nfunction tileRange (period, [[x1, y1], [x2, y2], [x3, y3], [x4, y4]]) {        \r\n    \r\n    let nw = sti (period, x1, y1) - (step (Math.abs(y1)) + 512);\r\n    let ne = sti (period, x2, y2) + (step (Math.abs(y2)) - 512);\r\n    let se = sti (period, x3, y3) + (step (Math.abs(y3)) + 512);\r\n    let sw = sti (period, x4, y4) - (step (Math.abs(y4)) - 512);\r\n\r\n    let rng = [];    \r\n    for (let lo = nw, hi = ne; hi <= se; lo += 256, hi += 256) {\r\n        let k = lo;\r\n        while (k <= hi) {\r\n            rng.push(k++);\r\n        }        \r\n    }\r\n    return rng;\r\n}\r\n\r\nfunction getShapefileObject(item, key) {\r\n\r\n    const drawingObject = getDrawingObject ({geoJSON: item});\r\n    const {name, color, editable, visible, geoJSON: {geometry, properties}} = drawingObject;\r\n    const itemId = '_item' + key;\r\n\r\n    return Object.assign(\r\n        {},\r\n        {\r\n            selectedName: name,\r\n            itemId,\r\n            name,\r\n            color,\r\n            editable,\r\n            visible\r\n        },\r\n        {geoJSON: {geometry, properties}}\r\n    );\r\n}\r\n\r\nfunction getCoordinatesCount(results) {\r\n\r\n    let numOfCoordinates = 0;\r\n\r\n    const recursiveArrayLength = data => {\r\n\r\n        for (let i = 0; i < data.length; i++) {\r\n\r\n            const currentArray = data[i];\r\n\r\n            if (currentArray instanceof Array) {\r\n                recursiveArrayLength(currentArray);\r\n            }\r\n            else {\r\n                numOfCoordinates++;\r\n            }\r\n        }\r\n    };\r\n\r\n    for (let i = 0; i < results.length; i++) {\r\n\r\n        const currentItem = results[i];\r\n        const {geometry: {coordinates = []}} = currentItem;\r\n\r\n        recursiveArrayLength(coordinates);\r\n    }\r\n\r\n    numOfCoordinates = Math.round(numOfCoordinates / 2);\r\n\r\n    return numOfCoordinates;\r\n}\r\n\r\nfunction getBounds (items) {        \r\n    let bounds = items.reduce((a,properties) => {\r\n        const geometry = L.gmxUtil.convertGeometry(properties[properties.length - 1], true, true);\r\n        let [[x1,y1],[x2,y2],[x3,y3],[x4,y4]] = getBbox(geometry);            \r\n        let ne = L.latLng(y2,x2);\r\n        let sw = L.latLng(y4,x4);\r\n        let b = L.latLngBounds(ne, sw);\r\n        if (a === null) {            \r\n            a = b;\r\n        }\r\n        else {\r\n            a.extend(b);\r\n        }\r\n        return a;\r\n    }, null);\r\n    let ne = bounds.getNorthEast();\r\n    let sw = bounds.getSouthWest();\r\n    const lng = ne.lng;\r\n    ne = L.latLng (ne.lat, makeCloseTo(lng, ne.lng));\r\n    sw = L.latLng (sw.lat, makeCloseTo(lng, sw.lng));\r\n    return L.latLngBounds(ne, sw);\r\n}\r\n\r\nfunction getRootUrl () {\r\n    let {origin, pathname} = location;\r\n    return `${origin}${pathname}`;\r\n}\r\n\r\nfunction getDifferenceBetweenDates(startDate, endDate) {\r\n\r\n    const startYear = startDate.getFullYear();\r\n    const startMonth = startDate.getMonth();\r\n    const startDay = startDate.getDate();\r\n\r\n    const endYear = endDate.getFullYear();\r\n    const endMonth = endDate.getMonth();\r\n    const endDay = endDate.getDate();\r\n\r\n    const startMomentDate = moment([startYear, startMonth, startDay]);\r\n    const endMomentDate = moment([endYear, endMonth, endDay]);\r\n\r\n    const monthDiff = startMomentDate.diff(endMomentDate, 'months');\r\n    const absMonthDiff = Math.abs(monthDiff);\r\n\r\n    if (absMonthDiff > 0) {\r\n        return `${absMonthDiff} мес`;\r\n    }\r\n\r\n    const dayDiff = startMomentDate.diff(endMomentDate, 'days');\r\n    const absDayDiff = Math.abs(dayDiff);\r\n\r\n    return `${absDayDiff} дн`;\r\n}\r\n\r\nfunction compareDates(one, two) {\r\n\r\n    const oneDate = new Date(one);\r\n    const twoDate = new Date(two);\r\n\r\n    return oneDate.getDay() === twoDate.getDay() && oneDate.getMonth() === twoDate.getMonth() && oneDate.getYear() === twoDate.getYear();\r\n}\r\n\r\nfunction prepareDate(date) {\r\n\r\n    let preparedDate = date;\r\n\r\n    preparedDate.setHours(0);\r\n    preparedDate.setMinutes(0);\r\n    preparedDate.setSeconds(0);\r\n\r\n    return preparedDate;\r\n}\r\n\r\nfunction getNowDate() {\r\n\r\n    let now = new Date();\r\n    now.setHours(0, 0, 0, 0);\r\n\r\n    return now;\r\n}\r\n\r\nexport {\r\n    hex,\r\n    unHex,\r\n    isNumber,\r\n    isNumeric,\r\n    createContainer,\r\n    getWindowCenter,\r\n    getMapCenter,\r\n    isMobile,\r\n    flatten,\r\n    getTotalHeight,\r\n    uppercaseFirstLetter,\r\n    makeCloseTo,\r\n    stRange,\r\n    toQuery,\r\n    getQuarters,\r\n    getSatelliteName,\r\n    createDefaultCriteria,\r\n    createDefaultFilter,\r\n    getPanelHeight,\r\n    splitComplexId,\r\n    fromGmx,\r\n    getDrawingObject,\r\n    getDrawingObjectArea,\r\n    splitOn180,\r\n    normalizeGeometry,\r\n    normalizeGeometryType,\r\n    isGeojsonFeature,\r\n    isGeometry,\r\n    getBbox,\r\n    tileRange,\r\n    getShapefileObject,\r\n    getCoordinatesCount,\r\n    getBounds,\r\n    getRootUrl,\r\n    getDifferenceBetweenDates,\r\n    compareDates,\r\n    prepareDate,\r\n    getNowDate\r\n};","import { getResourceServer } from 'scanex-auth';\r\nimport { chain } from 'scanex-async';\r\nimport { hex, fromGmx } from './utils/CommonUtils';\r\n\r\nwindow.LAYER_ID = '9B4733A8CBE942CE9F5E70DCAA6C1FBE'; // 'AFB4D363768E4C5FAC71C9B0C6F7B2F4'\r\n\r\nlet ss = ['WV03','WV02',\r\n'GE01','PHR','QB02',\r\n'KOMPSAT3A','KOMPSAT3',\r\n'IK','GF2',\r\n'KOMPSAT2',\r\n'SP6_7','BKA','GF1_2m','ZY3','RE',\r\n'LANDSAT_8',\r\n'GF1_16m',\r\n'WV01',\r\n'EROSB','EROSA',\r\n'GE01_L','IK_L','QB02_L','WV01_L','WV02_L',\r\n'SP5_2MS','SP5_5MS','SP5_10MS',\r\n'SP5_2PC','SP5_5PC'];\r\n\r\nlet gmxResourceServer = getResourceServer('geomixer');\r\n\r\nfunction read_permalink (state) {\r\n    return new Promise((resolve, reject) => {\r\n        gmxResourceServer.sendGetRequest('TinyReference/Get.ashx', { id: state.id })\r\n        .then(response => {\r\n            if (response.Status == 'ok') {\r\n                try {\r\n                    resolve(JSON.parse(response.Result));\r\n                }\r\n                catch (e) {\r\n                    reject(e);\r\n                }\t\t\t\t        \r\n            }\r\n            else {\r\n                reject(response.Result);\r\n            }\r\n        })\r\n        .catch(e => reject(e));\r\n    });\r\n}\r\n\r\nfunction get_query (ids) {\r\n    return ids.map(id => `(sceneid = '${id}')`).join (' OR ');\r\n}\r\n\r\nfunction search (ids) {\r\n    return new Promise((resolve, reject) => {        \r\n        if (ids.length > 0) {\r\n            gmxResourceServer.sendPostRequest('VectorLayer/Search.ashx', {\r\n                layer: LAYER_ID,\r\n                geometry: true,\r\n                pagesize: 0,\r\n                query: get_query(ids),\r\n                WrapStyle: 'message',\r\n            })\r\n            .then(response => {\r\n                if (response.Status == 'ok') {\r\n                    try {                        \r\n                        resolve(fromGmx(response.Result));\r\n                    }\r\n                    catch (e) {\r\n                        reject(e);\r\n                    }\t\t\t\t        \r\n                }\r\n                else {\r\n                    reject(response.Result);\r\n                }\r\n            })\r\n            .catch(e => reject(e));\r\n        }\r\n        else {            \r\n            resolve([]);\r\n        }\r\n    });\r\n}\r\n\r\nfunction get_items (state) {\r\n    return new Promise (resolve => {\r\n        search (state.selected.concat(state.quicklook))\r\n        .then (items => {\r\n            state.items = items;\r\n            state.items.forEach (item => {\r\n                item.quicklook = false;\r\n                if (Array.isArray(state.quicklook)) {\r\n                    for (let i = 0; i < state.quicklook.length; ++i) {\r\n                        if (state.visible[i] === item.sceneid) {\r\n                            item.quicklook = true;\r\n                            break;\r\n                        }           \r\n                    }\r\n                }\r\n\r\n                item.checked = false;\r\n                if (Array.isArray(state.cart)) {\r\n                    for (let i = 0; i < state.cart.length; ++i) {\r\n                        if (state.cart[i] === item.sceneid) {\r\n                            item.checked = true;\r\n                            break;\r\n                        }           \r\n                    }\r\n                }\r\n                                                 \r\n            });\r\n            resolve(state);\r\n        })\r\n        .catch (e => {\r\n            console.log(e);\r\n            resolve(state);\r\n        });\r\n    });\r\n}\r\n\r\nfunction get_cart (state) {\r\n    return new Promise (resolve => {\r\n        search (state.cart)\r\n        .then (items => {\r\n            state.cart = items;\r\n            resolve(state);\r\n        })\r\n        .catch (e => {\r\n            console.log(e);\r\n            resolve(state);\r\n        });\r\n    });\r\n}\r\n\r\nlet matches = /\\?([^&]+)/g.exec(window.location.search);\r\nif (matches.length > 1) {\r\n    let id = matches[1];\r\n    chain([\r\n        read_permalink,\r\n        get_items,\r\n        get_cart,\r\n    ], {id})\r\n    .then(state => {\r\n        let {\r\n            lang, \r\n            position,\r\n            bounds,\r\n            cadastre,\r\n            activeLayer,\r\n            drawingObjects,\r\n            searchCriteria: { \r\n                dateStart, dateEnd, \r\n                isYearly, \r\n                minCloudCover, maxCloudCover, \r\n                minAngle, maxAngle,\r\n                archive,\r\n                stereo,\r\n                satellites,\r\n            },\r\n            cart,\r\n            items,\r\n        } = state;\r\n        let rxDate = new RegExp ('(\\\\d{2})\\\\.(\\\\d{2})\\\\.(\\\\d{4})');\r\n        let d1 = rxDate.exec(dateStart);\r\n        let d2 = rxDate.exec(dateEnd);\r\n        let date = [`${d1[3]}-${d1[2]}-${d1[1]}`,`${d2[3]}-${d2[2]}-${d2[1]}`];\r\n        let st = satellites.reduce((a,i) => {\r\n            let s = ss[i];\r\n            let k = s.lastIndexOf('_L');\r\n            if (k > -1){                                        \r\n                let x = s.substr(0, k);\r\n                if (x === 'WV01') {\r\n                    a.pc.push (x);\r\n                }\r\n                else {\r\n                    a.ms.push (x);\r\n                }\r\n            }\r\n            else if (s in ['WV01', 'EROSA', 'EROSB']) {\r\n                a.pc.push (s);\r\n            }\r\n            else {\r\n                a.ms.push (s);\r\n            }\r\n            return a;\r\n        }, {ms: [], pc: []});\r\n        let objects = drawingObjects.map (item => {\r\n            let {name, color, checked} = item.properties;\r\n            return {\r\n                name: name,\r\n                geoJSON: item,\r\n                color: typeof color === 'string' && color !== '' ? `#${hex(color, 6)}` : '#0033FF',\r\n                visible: checked,\r\n            };\r\n        });        \r\n        let viewState = {\r\n            lang,\r\n            activeLayer,\r\n            drawingObjects: objects,\r\n            position,                \r\n            bounds,                \r\n            searchCriteria: {\r\n                date,\r\n                annually: isYearly,\r\n                angle: [minAngle, maxAngle],\r\n                clouds: [minCloudCover, maxCloudCover],\r\n                stereo,\r\n                archive,\r\n                satellites: st,\r\n            },\r\n            items,\r\n            cart,\r\n            cadastre,\r\n        };\r\n        localStorage.setItem('view_state', JSON.stringify(viewState));\r\n        window.location = `${window.location.origin}${window.location.pathname.substr(0, window.location.pathname.lastIndexOf('/'))}`;\r\n    });\r\n}"],"names":["EventTarget","listeners","type","callback","push","addEventListener","stack","i","l","length","splice","removeEventListener","event","Object","defineProperty","enumerable","configurable","writable","value","call","uniqueGlobalName","freeid","id","window","thing","sendCrossDomainJSONRequest","url","callbackParamName","errorCallback","script","document","createElement","setAttribute","callbackName","obj","getElementsByTagName","item","removeChild","sepSym","indexOf","onerror","Math","random","appendChild","AuthManager","authorizationEndpoint","userInfoEndpoint","redirectEndpointHtml","redirectEndpointAshx","credentialLoginEndpoint","clientId","_authorizationEndpoint","_userInfoEndpoint","_redirectEndpointHtml","_redirectEndpointAshx","_redirectEndpointAshx2","location","href","_credentialLoginEndpoint","_resourceServers","_clientId","cookieName","re","RegExp","cookie","replace","resourceServer","tasks","state","reduce","prev","next","then","Promise","resolve","reject","map","rs","sendGetRequest","concat","response","catch","e","_chain","search","parseQueryString","a","slice","split","o","s","params","error","Status","Result","Error","message","resp","arguments","_getUserInfoDeferred","authorizationGrant","setTimeout","body","querySelector","_processAuthorization","err","_authorizeResourceServers","scope","servers","Service","ServerId","State","bind","insertAdjacentHTML","arg","foreignServer","iframeContainer","authUrl","open","reload","createEvent","initEvent","dispatchEvent","self","login","password","encodeURIComponent","toLowerCase","getUserInfo","Message","promises","promise","copy","source","Array","isArray","Date","keys","k","extend","target","babelHelpers.typeof","DropdownWidget","options","title","trigger","direction","adjustWidth","showTopItem","titleClassName","$el","el","classList","add","$titleContainer","innerHTML","$dropdownContainer","style","display","$dropdownTitle","expand","collapse","_items","inst","position","$container","detail","dataId","je","currentTarget","getAttribute","_sortItems","_expanded","r","getBoundingClientRect","minWidth","width","containerEl","items","prototype","children","titleEl","positions","parseInt","maxPositionIndex","max","apply","insertBefore","DropdownMenuWidget","_view","_renderItem","join","dropDown","mouseTimeout","querySelectorAll","mouseIsOver","dd","className","link","newWindow","icon","fonticon","dropdown","_renderDropdown","placeholder","DEFAULT_LANGUAGE","Translations","_hash","lang","_language","language","tran","key","locale","getLanguage","Scanex","translations","T","addText","auth","AuthWidget","_authManager","authManager","_userInfo","_options","showAccountLink","accountLink","showMapLink","_render","Login","userName","FullName","Nickname","nickName","vm","getText","dropdownItems","iconClass","defaultMapLink","mapLink","dropdownMenuWidget","MenuWidget","appendTo","loginBtn","$iframeContainer","logoutBtn","logout","parseUri","str","parser","m","exec","uri","hostOnly","host","authority","requests","lastRequestId","uniquePrefix","processMessage","origin","dataStr","decodeURIComponent","data","dataObj","JSON","parse","request","CallbackName","iframe","parentNode","attachEvent","addQueryVariables","variables","oldQueryString","newQueryString","variable","hasOwnProperty","createPostIframe","src","Server","root","_root","requestUrl","img","Image","onload","errors","baseForm","requestURL","processResponse","parsedURL","protocol","originalFormAction","form","hiddenParamsDiv","appendFormParam","paramName","paramValue","input","submit","removeAttribute","ResourceServer","_id","$addResourceServer","sync","$getAntiCsrfToken","ErrorInfo","resourceServersInstances","resourceServersConstructors","getResourceServer","getAuthManager","chain","MAP_INIT_SETTINGS","center","L","LatLng","minZoom","maxZoom","zoom","boxZoom","srs","skipTiles","ftc","attributionControl","zoomControl","squareUnit","distanceUnit","maxBounds","latLngBounds","latLng","EAST_HEMISPHERE","bounds","point","WEST_HEMISPHERE","WEST_HEMISPHERE2","Satellite","platforms","name","resolution","swath","operator","since","ms","arity","restricted","checked","endingDate","_platforms","_name","_resolution","_swath","_operator","_since","_arity","_ms","_restricted","_checked","_endingDate","archive","x","islocal","DG","KOMPSAT","SpaceView","GF1","sensor","_sensor","SV1","Airbus","PHR","PLD_1A","SP5_10MS","authorized","SP5_5MS","SP5_5PC","SP5_2MS","SP5_2PC","SP6_7","SP6_7_1A","SP67_P","EROS","RP","RP_PC","RP_1MS","RP_4MS","Triplesat","satellites","pc","get_name","b","y","names","hex","number","h","toString","toUpperCase","fromGmx","fields","values","types","convertMercator","gmxUtil","geometryToGeoJSON","stereo","geomixergeojson","geoJSON","sceneid","LAYER_ID","ss","gmxResourceServer","read_permalink","get_query","ids","sendPostRequest","layer","geometry","pagesize","query","WrapStyle","get_items","selected","quicklook","forEach","visible","cart","console","log","get_cart","matches","cadastre","activeLayer","drawingObjects","searchCriteria","dateStart","dateEnd","isYearly","minCloudCover","maxCloudCover","minAngle","maxAngle","rxDate","d1","d2","date","st","lastIndexOf","substr","objects","properties","color","viewState","annually","angle","clouds","localStorage","setItem","stringify","pathname"],"mappings":"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"}